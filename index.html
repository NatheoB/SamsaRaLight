<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Forest light computation • SamsaRaLight</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Forest light computation">
<meta name="description" content="The package computes annuel direct and diffuse rays to estimate tree light interception by 3D crowns and light on the ground within a forest.">
<meta property="og:description" content="The package computes annuel direct and diffuse rays to estimate tree light interception by 3D crowns and light on the ground within a forest.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="samsaralight">SamsaRaLight<a class="anchor" aria-label="anchor" href="#samsaralight"></a>
</h1></div>
<p>The R package SamsaraLight provides a simpler and faster way to use the SamsaraLight ray-tracing model within the R environment. SamsaraLight is a forest radiative transfer model based on ray tracing (Courbaud et al., 2003) that enables users to estimate the light intercepted by each tree and the light that reaches the ground or virtual light sensors, in a given forest stand inventory.</p>
<div class="section level2">
<h2 id="installation-of-the-samsaralight-r-package">Installation of the SamsaRaLight R package<a class="anchor" aria-label="anchor" href="#installation-of-the-samsaralight-r-package"></a>
</h2>
<p>You can install the development version of SamsaRaLight from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"NatheoB/SamsaRaLight"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="global-description-of-the-samsaralight-model">Global description of the SamsaraLight model<a class="anchor" aria-label="anchor" href="#global-description-of-the-samsaralight-model"></a>
</h2>
<div class="section level3">
<h3 id="id_1---construct-the-virtual-stand-from-an-input-tree-inventory">1 - Construct the virtual stand from an input tree inventory<a class="anchor" aria-label="anchor" href="#id_1---construct-the-virtual-stand-from-an-input-tree-inventory"></a>
</h3>
<p>The user’s inventory plot is represented by an axis-aligned rectangle with a specified slope and aspect. The constructed virtual stand is then divided into square cells of the same size for use in the ray-tracing model.</p>
<p>The user’s inventoried trees are located within this virtual stand, with each tree’s crown represented by a simple 3D geometric volume whose dimensions and shape are defined by the user. The crown can be given a symmetrical shape, such as an ellipsoid (typically used for broadleaves) or a paraboloid (typically used for conifers). Users can increase the complexity of the crown representation by using asymmetric shapes and defining the crown radii at the four cardinal points, as well as the height at which the crown radius is at its maximum. This can be constructed easily and automatically in the model using parts of ellipsoids and paraboloids (<em>i.e.</em> two halves or eight eighths of an ellipsoid, or four quarters of a paraboloid).</p>
</div>
<div class="section level3">
<h3 id="id_2---discretize-the-annual-light">2 - Discretize the annual light<a class="anchor" aria-label="anchor" href="#id_2---discretize-the-annual-light"></a>
</h3>
<p>Based on the user definition of the monthly radiations (<em>i.e.</em> global energy in an horizontal plane (in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>J</mi><mi>.</mi><mi>h</mi><msup><mi>a</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">MJ.ha^{-1}</annotation></semantics></math>) and the ratio between diffuse and global energy for a given month), the SamsaraLight ray-tracing model discretizes annual light into a finite number of direct and diffuse rays. Considering whether direct or diffuse light, the model calculates the angles (height angle), orientation (azimuth) and energy of diffuse and direct light rays depending on plot latitude (more direct radiations with greater height angle toward lower latitudes in Spain, compared to more diffuse and horizontal rays towards higher latitudes in Scandinavia).</p>
</div>
<div class="section level3">
<h3 id="id_3---cast-the-light-rays-toward-the-stand">3 - Cast the light rays toward the stand<a class="anchor" aria-label="anchor" href="#id_3---cast-the-light-rays-toward-the-stand"></a>
</h3>
<p>The model then cast</p>
</div>
<div class="section level3">
<h3 id="id_4---estimate-light-interception-by-trees">4 - Estimate light interception by trees<a class="anchor" aria-label="anchor" href="#id_4---estimate-light-interception-by-trees"></a>
</h3>
<p>Thus, when a ray intercepts the crown of a tree, the intercepted light energy is calculated by considering the crown as a turbid medium and applying Beer-Lambert’s law, taking into account the incident energy of the ray and the leaf area density of the tree. It assumes that the leaves are arranged homogeneously and not aggregated within the canopy.</p>
<p>To consider the fact that we don’t know the environment around the stand, it represents plot boundaries with a torus system (Courbaud et al. 2003). Indeed, trees around the border of the stand are not described but they also participates to the attenuation of the coming rays. Thus, if we do not consider environment after boundaries, we overestimate interception of light, especially for trees closer to the plot boundaries.</p>
</div>
<div class="section level3">
<h3 id="id_5---compute-the-output-energy-and-light-competition-variables">5 - Compute the output energy and light competition variables<a class="anchor" aria-label="anchor" href="#id_5---compute-the-output-energy-and-light-competition-variables"></a>
</h3>
<p>In this way, it estimates the attenuation of the energy of each light ray following successive interceptions by the tree crowns, and calculates the sum of the intercepted energy from each ray, for all the trees in the stand, and the consequent energy reaching each cell. By doing so, light variables can be derived from total energies and some example of usual indicators are provided in the outputs, such as LCI for trees or PACL for ground light.</p>
</div>
</div>
<div class="section level2">
<h2 id="package-functionnalities">Package functionnalities<a class="anchor" aria-label="anchor" href="#package-functionnalities"></a>
</h2>
</div>
<div class="section level2">
<h2 id="main-r-functions-and-pipeline">Main R functions and pipeline<a class="anchor" aria-label="anchor" href="#main-r-functions-and-pipeline"></a>
</h2>
<div class="section level3">
<h3 id="prepare-the-inputs">Prepare the inputs<a class="anchor" aria-label="anchor" href="#prepare-the-inputs"></a>
</h3>
<p>In case of the user’s complex inventory protocol (i.e. non-axis-aligned rectangle or non-rectangular shape), the R package allows</p>
</div>
<div class="section level3">
<h3 id="run-the-model">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h3>
</div>
<div class="section level3">
<h3 id="analyse-the-outputs">Analyse the outputs<a class="anchor" aria-label="anchor" href="#analyse-the-outputs"></a>
</h3>
</div>
</div>
<div class="section level2">
<h2 id="learn-with-applied-tutorials">Learn with applied tutorials<a class="anchor" aria-label="anchor" href="#learn-with-applied-tutorials"></a>
</h2>
<p>You can find simple examples as tutorial for different stand situations and with different tree crown dimensions accuracy:</p>
<ol style="list-style-type: decimal">
<li>Compute light interception with simplified symmetric crowns</li>
<li>Consider interception of light by trunks</li>
<li>Complexify crown representation with irregular crowns</li>
</ol>
</div>
<div class="section level2">
<h2 id="inputs">Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h2>
<div class="section level3">
<h3 id="stand-geometry">Stand geometry<a class="anchor" aria-label="anchor" href="#stand-geometry"></a>
</h3>
<p>You first need to consider the geometry of the stand as argument of the <code>sl_run()</code> function.</p>
<p>You will need the <code>latitude</code> of the plot (Y-coordinate in WGS84 system) for computation of angle and azimuth of each diffuse and direct rays.</p>
<p>The forest stand is defined as a flat plane with a given :</p>
<ul>
<li><p><code>slope</code> (uniform slope in degrees of the flat plane)</p></li>
<li><p><code>aspect</code> (Angle of slope bottom on the compass from the North, clockwise rotation in degrees. northern aspect = 0, eastern aspect = 90, southern aspect = 180, western aspect = 270)</p></li>
<li><p><code>north_to_x_cw</code> (Angle from North to x axis clockwise in degrees, the default 90 value corresponds to a Y axis oriented toward the North)</p></li>
</ul>
<p>You need to define the size of the plot by setting the size (<code>cell_size</code>) and the number of cells composing the plot (<code>n_cells_x</code> and <code>n_cells_x</code>, respectively the number of cells in a column and a row).</p>
<p>All the diffuse and direct rays are launch towards the center of each cell with a computed azimuth and angle. Then, the more cells there are in the plot, the more rays will be launched , and the longer the calculation time will be.</p>
</div>
<div class="section level3">
<h3 id="trees-description">Trees description<a class="anchor" aria-label="anchor" href="#trees-description"></a>
</h3>
<p>Then, you need to provide a well formatted data.frame containing description of each tree of the plot.</p>
<p>The trees data.frame should contain all the below variables, with the correct name and type of the column:</p>
<ul>
<li><p><code>id_tree</code>: Unique id of the tree (integer)</p></li>
<li><p><code>x</code>, <code>y</code>: Relative location of the tree in the stand (double, in m)</p></li>
<li><p><code>crown_type</code>: Type of the crown form. Between “E” and “P” for symmetric crown (see tutorial n°1). Between “2E”, “8E” or “4P” for irregular crowns (see tutorial n°3) (character)</p></li>
<li><p><code>dbh_cm</code>: Diameter at breast height (1.30m) of the trunk of the tree (double, in cm) (Can be set to NA if one do not consider light interception by trunks, otherwise, see tutorial n°2)</p></li>
<li>
<p><code>h_m</code>: Height of the top of the tree crown from the ground (double, in</p>
<ol start="13" style="list-style-type: lower-alpha"><li>
</li></ol>
</li>
<li><p><code>hbase_m</code>: Height of the tree crown base (double, in m)</p></li>
<li><p><code>hmax_m</code>; Height at which the tree crown diameter is the biggest (double, in m)</p></li>
<li><p><code>rn_m</code>, <code>rs_m</code>, <code>re_m</code>, <code>rw_m</code>: Tree crown radius at hmax towards respectively North, South, East and West (in m, double).</p></li>
<li><p><code>crown_lad</code>: Leaf Area Density of the tree crown (in m2/m3) (i.e. surface of leave per volume of crown, considering an homogeneous crown). (Used when computing interception with a crown considered as a turbid medium, i.e argument turbid_medium = TRUE, can be set to NA otherwise). (double)</p></li>
<li><p><code>crown_openess</code>: Crown Openness of the tree (no unit) (i.e. Fraction of the energy of a light ray crossing the crown that is intercepted). (Used when computing interception with a crown considered as a porous envelop, i.e argument turbid_medium = FALSE, can be set to NA otherwise). (double)</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="monthly-radiation">Monthly radiation<a class="anchor" aria-label="anchor" href="#monthly-radiation"></a>
</h3>
<p>You will also need to provide a data.frame to that indicates the monthly radiations. You need to provide three columns with 12 rows, each indicating radiations for a month:</p>
<ul>
<li><p><code>month</code>: the month between 1 and 12</p></li>
<li><p><code>Hrad</code>: monthly global radiation on a horizontal plane in MJ.m^2</p></li>
<li><p><code>DGratio</code>: ratio of monthly diffuse energy to global energy (needed to compute direct energy)</p></li>
</ul>
<p>You can fetch this data.frame for a given <code>latitude</code> and <code>longitude</code> using the function <code>get_monthly_rad()</code>. It fetches monthly data between given start and end year (range between 2005 and 2020) from the PVGIS database <a href="https://joint-research-centre.ec.europa.eu/pvgis-photovoltaic-geographical-information-system_en" class="external-link uri">https://joint-research-centre.ec.europa.eu/pvgis-photovoltaic-geographical-information-system_en</a>. Here, you can choose to average the monthly values between all the years between 2005 and 2020 or to choose values of a given year.</p>
</div>
</div>
<div class="section level2">
<h2 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a>
</h2>
<p>The function returns a list with two data.frames:</p>
<p><code>trees</code>: Light interception for each tree</p>
<ul>
<li><p><code>epot</code>: Potential energy intercepted by the tree without its neighbours (in MJ/year)</p></li>
<li><p><code>e</code>: Energy intercepted by the tree when considering competition with neighbours (in MJ/year)</p></li>
</ul>
<p><code>cells</code>: Light coming to each cell of the plot</p>
<ul>
<li><p><code>e</code>: Total energy arriving to the cell (in MJ/year)</p></li>
<li><p><code>erel</code>: Relative energy coming to the cell compared to the one above canopy. It ranges from 0 (no light on the ground) to 1 (no energy has been intercepted by above trees).</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="bibliography">Bibliography<a class="anchor" aria-label="anchor" href="#bibliography"></a>
</h2>
<p>[1] Courbaud, B. et al. (2015). “Applying ecological model evaludation: Lessons learned with the forest dynamics model Samsara2”. Ecological Modelling 314, p. 1. doi: 10.1016/j.ecolmodel.2015.06.039.</p>
<p>[2] Courbaud, B., F. de Coligny, and T. Cordonnier (2003). “Simulating radiation distribution in a heterogeneous Norway spruce forest on a slope”. Agricultural and Forest Meteorology 116.1, pp. 1–18. doi: 10.1016/S0168-1923(02)00254-X.</p>
<p>[3] Ligot, G., Balandier, P., Courbaud, B., Claessens, H., 2014. “Forest radiative transfer models: which approach for which application?”. Can. J. For. Res. 44:385-397. <a href="https://hdl.handle.net/2268/163600" class="external-link uri">https://hdl.handle.net/2268/163600</a></p>
<p>[4] Ligot, G., Balandier, P., Coubraud, B., Jonard, M., Kneeshaw, D., Claessens, H, 2014. “Managing understory light to maintain a mixture of species with different shade tolerance”. For. Ecol. Manage. 327:189-200.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing SamsaRaLight</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Natheo Beauchamp <br><small class="roles"> Author, maintainer </small>   </li>
<li>Gauthier Ligot <br><small class="roles"> Author, copyright holder </small>   </li>
<li>Francois de Coligny <br><small class="roles"> Author </small>   </li>
<li>Maxime Jaunatre <br><small class="roles"> Author </small>   </li>
<li>Benoit Courbaud <br><small class="roles"> Author, copyright holder </small>   </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
