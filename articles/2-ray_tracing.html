<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2 - Ray discretization • SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2 - Ray discretization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-minimal_case.html">1 - A first minimal case</a></li>
    <li><a class="dropdown-item" href="../articles/2-ray_tracing.html">2 - Ray discretization</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2 - Ray discretization</h1>
            <h3 data-toc-skip class="subtitle">Understand ray
discretization of direct and diffuse radiations</h3>
            
      

      <div class="d-none name"><code>2-ray_tracing.Rmd</code></div>
    </div>

    
    
<p>In this tutorial, we will go deeper into the SamsaraLight model to
better understand ray-tracing, from discretisation of direct and diffuse
rays to the effect of stand geometry and latitude on light distribution
on the ground. To do so, we will create from scratch a virtual stand
with a single large tree at the center to observe its shading effect and
how it varies between three different cities in Europe (Madrid, Brussels
and Oslo) and three different stand geometry (a flat plane, a South- or
a North-facing slope).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="prepare-the-experiment">Prepare the experiment<a class="anchor" aria-label="anchor" href="#prepare-the-experiment"></a>
</h2>
<div class="section level3">
<h3 id="create-the-tree-inventory">Create the tree inventory<a class="anchor" aria-label="anchor" href="#create-the-tree-inventory"></a>
</h3>
<p>We can take an example dataset to observe which variable we need to
create the tree inventory:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id_tree"        "species"        "x"              "y"             </span></span>
<span><span class="co">#&gt;  [5] "dbh_cm"         "crown_type"     "h_m"            "hbase_m"       </span></span>
<span><span class="co">#&gt;  [9] "hmax_m"         "rn_m"           "re_m"           "rs_m"          </span></span>
<span><span class="co">#&gt; [13] "rw_m"           "crown_openness" "crown_lad"</span></span></code></pre></div>
<p>Initialise the stand size, say 100x100m 1ha square plot:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_size_x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">stand_size_y</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></code></pre></div>
<p>Thus, create the tree inventory with one single large tree at the
center of the plot:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id_tree <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"not specified"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">stand_size_x</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>  y <span class="op">=</span> <span class="va">stand_size_y</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>  dbh_cm <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  crown_type <span class="op">=</span> <span class="st">"E"</span>, <span class="co"># Symmetric ellipsoidal crown</span></span>
<span>  h_m <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  hbase_m <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  rn_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  re_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  rs_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  rw_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  crown_lad <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># Base LAD value, see Tutorial 3 and Tutorial 6 for deeper explanations</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">trees_inv</span></span>
<span><span class="co">#&gt;   id_tree       species  x  y dbh_cm crown_type h_m hbase_m rn_m re_m rs_m rw_m</span></span>
<span><span class="co">#&gt; 1       1 not specified 50 50    100          E  40      20    6    6    6    6</span></span>
<span><span class="co">#&gt;   crown_lad</span></span>
<span><span class="co">#&gt; 1       0.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-the-experimental-design">Define the experimental design<a class="anchor" aria-label="anchor" href="#define-the-experimental-design"></a>
</h3>
<p>Here, we define the experimental design, that is the
latitude/slope/aspect combinations we want to test. We will study 9
modalities as a combination of 3 latitudes representative of three
cities in Europe (Madrid, Brussels and Oslo) and 3 stand geometry with
different slope and aspect (a flat plane, a 20° north-facing slope and a
20° south-facing slope).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Madrid"</span>, <span class="st">"Brussels"</span>, <span class="st">"Oslo"</span><span class="op">)</span>, <span class="co"># Define three towns with different latitudes in Europe</span></span>
<span>  slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  aspect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">180</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Set the longitude/latitude of our three towns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    latitude <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">city</span>,</span>
<span>                          <span class="st">"Madrid"</span> <span class="op">~</span> <span class="fl">40.4167</span>,</span>
<span>                          <span class="st">"Brussels"</span> <span class="op">~</span> <span class="fl">50.8477</span>,</span>
<span>                          <span class="st">"Oslo"</span> <span class="op">~</span> <span class="fl">59.9122</span><span class="op">)</span>,</span>
<span>    longitude <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">city</span>,</span>
<span>                          <span class="st">"Madrid"</span> <span class="op">~</span> <span class="op">-</span><span class="fl">3.7033</span>,</span>
<span>                          <span class="st">"Brussels"</span> <span class="op">~</span> <span class="fl">4.3572</span>,</span>
<span>                          <span class="st">"Oslo"</span> <span class="op">~</span> <span class="fl">10.7313</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">slope</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">aspect</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Because aspect do not change anything in a flat plane</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stand_geom <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>                  <span class="va">slope</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"flat plane"</span>,</span>
<span>                  <span class="va">slope</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">aspect</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"north-facing slope"</span>,</span>
<span>                  <span class="va">slope</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">aspect</span> <span class="op">==</span> <span class="fl">180</span> <span class="op">~</span> <span class="st">"south-facing slope"</span><span class="op">)</span>,</span>
<span>                id_simu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">id_simu</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exp_design</span></span>
<span><span class="co">#&gt;   id_simu     city slope aspect latitude longitude         stand_geom</span></span>
<span><span class="co">#&gt; 1       1   Madrid     0      0  40.4167   -3.7033         flat plane</span></span>
<span><span class="co">#&gt; 2       2 Brussels     0      0  50.8477    4.3572         flat plane</span></span>
<span><span class="co">#&gt; 3       3     Oslo     0      0  59.9122   10.7313         flat plane</span></span>
<span><span class="co">#&gt; 4       4   Madrid    20      0  40.4167   -3.7033 north-facing slope</span></span>
<span><span class="co">#&gt; 5       5 Brussels    20      0  50.8477    4.3572 north-facing slope</span></span>
<span><span class="co">#&gt; 6       6     Oslo    20      0  59.9122   10.7313 north-facing slope</span></span>
<span><span class="co">#&gt; 7       7   Madrid    20    180  40.4167   -3.7033 south-facing slope</span></span>
<span><span class="co">#&gt; 8       8 Brussels    20    180  50.8477    4.3572 south-facing slope</span></span>
<span><span class="co">#&gt; 9       9     Oslo    20    180  59.9122   10.7313 south-facing slope</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-monthly-radiations-tables">Create monthly radiations tables<a class="anchor" aria-label="anchor" href="#create-monthly-radiations-tables"></a>
</h3>
<p>For each unique city (Madrid, Brussels and Oslo), create the monthly
radiation tables containing for each of the 12 months information about
global energy quantity () and the ratio of this energy between diffuse
and direct energies (DGratio), in MJ/m2. It is important to note that
the monthly values here correspond to radiations received on a
horizontal plane and are subsequently corrected by the model to estimate
incident radiation on sloped surfaces.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get each unique city coordinate</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="va">exp_design</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">city</span>, <span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the list of radiation tables</span></span>
<span><span class="va">data_rad_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_rad_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">coords</span><span class="op">$</span><span class="va">city</span></span>
<span></span>
<span><span class="co"># Fetch </span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">data_rad_list</span><span class="op">[[</span><span class="va">coords</span><span class="op">$</span><span class="va">city</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/get_monthly_radiations.html">get_monthly_radiations</a></span><span class="op">(</span></span>
<span>    latitude <span class="op">=</span> <span class="va">coords</span><span class="op">$</span><span class="va">latitude</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, </span>
<span>    longitude <span class="op">=</span> <span class="va">coords</span><span class="op">$</span><span class="va">longitude</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="../reference/check_monthly_radiations.html">check_monthly_radiations</a></span><span class="op">(</span><span class="va">data_rad_list</span><span class="op">[[</span><span class="va">coords</span><span class="op">$</span><span class="va">city</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Radiation table successfully validated.</span></span>
<span><span class="co">#&gt; Radiation table successfully validated.</span></span>
<span><span class="co">#&gt; Radiation table successfully validated.</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the plot with monthly global energies</span></span>
<span><span class="va">plt_hrad</span> <span class="op">&lt;-</span> <span class="va">data_rad_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Hrad</span>, x <span class="op">=</span> <span class="va">month</span>, color <span class="op">=</span> <span class="va">city</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Global energy"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the plot with monthly ratio between diffuse and direct rays</span></span>
<span><span class="va">plt_dgratio</span> <span class="op">&lt;-</span> <span class="va">data_rad_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">DGratio</span>, x <span class="op">=</span> <span class="va">month</span>, color <span class="op">=</span> <span class="va">city</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Ratio diffuse/global"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get legend containing cities</span></span>
<span><span class="va">legend_radiation</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html" class="external-link">get_legend</a></span><span class="op">(</span><span class="va">plt_hrad</span><span class="op">)</span></span>
<span><span class="va">plt_hrad</span> <span class="op">&lt;-</span> <span class="va">plt_hrad</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combines the plots</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">legend_radiation</span>,</span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plt_hrad</span>, <span class="va">plt_dgratio</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<p>Across all cities, monthly global radiation peaks during spring and
summer due to longer daylight and higher solar elevation angles, which
reduce atmospheric scattering and favor direct radiation. In contrast,
winter months combine shorter days, lower sun angles, and increased
atmospheric path length, leading to lower global energy and a higher
diffuse fraction.</p>
<p>Madrid exhibits higher global radiation and a lower diffuse-to-global
ratio due to its lower latitude, which results in higher solar
elevations, shorter atmospheric path lengths, and therefore a dominance
of direct radiation throughout the year. However, the effect of latitude
tends to plateau: Brussels (50°N) and Oslo (60°N) exhibit similar
monthly radiation totals and diffuse/direct ratios. This results from a
compensation between lower solar elevation and longer day length: at
high latitudes, summer radiation is characterized by long-lasting
low-angle direct sunlight, which can dominate over diffuse radiation
when integrated over the month.</p>
<p>Although the total amount and partitioning of radiation are
comparable between Brussels and Oslo, the geometric distribution of
direct rays differs markedly as we will explore later in this tutorial,
which has strong implications for 3D light interception and shading
patterns.</p>
</div>
<div class="section level3">
<h3 id="create-the-samsaralight-input-stands">Create the SamsaRaLight input stands<a class="anchor" aria-label="anchor" href="#create-the-samsaralight-input-stands"></a>
</h3>
<p>First, we have to define our tree inventory zone by defining a table
with each vertex of our polygon. In our case, it a square of 100x100m,
thus 4 vertices with combination of 0 and 100 as coordinates. Be
careful, we have to define the vertices in the correct order to have a
mathematically correct polygon, otherwise, the function will first try
to correct your polygon, and if it fails, it will send an error.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">core_polygon_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">core_polygon_df</span></span>
<span><span class="co">#&gt;     x   y</span></span>
<span><span class="co">#&gt; 1   0   0</span></span>
<span><span class="co">#&gt; 2 100   0</span></span>
<span><span class="co">#&gt; 3 100 100</span></span>
<span><span class="co">#&gt; 4   0 100</span></span></code></pre></div>
<p>Then, we create the SamsaRaLight input stand from the created tree
inventory, for each of the different stand geometry and latitude in our
experimental design. We set the cell size as 1x1m in order to observe
with great precision the shading effect of the tree within the
stand.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_stand_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mod_design</span> <span class="op">&lt;-</span> <span class="va">exp_design</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span> </span>
<span>  <span class="co"># Create the stand with given stand geometry, tree inventory and latitude</span></span>
<span>  <span class="va">sl_stand_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>    trees_inv <span class="op">=</span> <span class="va">trees_inv</span>,</span>
<span>    cell_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    latitude <span class="op">=</span> <span class="va">mod_design</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>    slope <span class="op">=</span> <span class="va">mod_design</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>    aspect <span class="op">=</span> <span class="va">mod_design</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>    north2x <span class="op">=</span> <span class="fl">90</span>, <span class="co"># i.e. Y-axis oriented to real North</span></span>
<span>    core_polygon_df <span class="op">=</span> <span class="va">core_polygon_df</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="run-samsaralight">Run SamsaRaLight<a class="anchor" aria-label="anchor" href="#run-samsaralight"></a>
</h2>
<p>We can now easily run the SamsaraLight ray-tracing model on our 9
virtual stands. Here, we decided to not use the torus as we want to
observe the shading effect of only the single tree in the middle of the
plot, thus considering the virtual 100x100m is surrounded by
grasslands.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store SamsaraLight outputs in a list</span></span>
<span><span class="va">out_sl_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mod_design</span> <span class="op">&lt;-</span> <span class="va">exp_design</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Run SamsaraLight</span></span>
<span>  <span class="va">out_sl_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/run_sl.html">run_sl</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># Simulation inputs</span></span>
<span>    sl_stand <span class="op">=</span> <span class="va">sl_stand_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    monthly_radiations <span class="op">=</span> <span class="va">data_rad_list</span><span class="op">[[</span><span class="va">mod_design</span><span class="op">$</span><span class="va">city</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    </span>
<span>    <span class="co"># Define stand boundaries</span></span>
<span>    use_torus <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    </span>
<span>    <span class="co"># Set detailed output to have information about ray-discretization and direct/diffuse outputs</span></span>
<span>    detailed_output <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    </span>
<span>    <span class="co"># Activate parallel mode</span></span>
<span>    parallel_mode <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="understand-the-detailed-output">Understand the detailed output<a class="anchor" aria-label="anchor" href="#understand-the-detailed-output"></a>
</h2>
<div class="section level3">
<h3 id="the-change-in-incident-energy-with-stand-latitude-and-stand-geometry">The change in incident energy with stand latitude and stand
geometry<a class="anchor" aria-label="anchor" href="#the-change-in-incident-energy-with-stand-latitude-and-stand-geometry"></a>
</h3>
<p>The annual incident energy of diffuse and direct rays (in MJ/m2),
integrated over the year, is provided for both a horizontal surface and
the slope in <code>output$monthly_rays$energies</code>, returned by the
<code><a href="../reference/run_sl.html">run_sl()</a></code> function. These values represent the annual
radiation above the canopy and can be interpreted as the energy reaching
the forest floor in the absence of trees, either on a horizontal plane
or on the slope. In the ray-tracing model, incident energy on the slope
is used to compute tree light interception and energy received by ground
cells, whereas energy on a horizontal plane is used for radiation
reaching virtual sensors (see Tutorial 3: Understanding transmission
models with virtual sensors).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dataframe for comparing incident energies</span></span>
<span><span class="va">out_sl_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">monthly_rays</span><span class="op">$</span><span class="va">energies</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"id_simu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>horizontal_total <span class="op">=</span> <span class="va">horizontal_direct</span> <span class="op">+</span> <span class="va">horizontal_diffuse</span>,</span>
<span>                slope_total <span class="op">=</span> <span class="va">slope_direct</span> <span class="op">+</span> <span class="va">slope_diffuse</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">id_simu</span>, </span>
<span>                      names_pattern <span class="op">=</span> <span class="st">"(.*)_(.*)"</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surface"</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"energy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">exp_design</span>, by <span class="op">=</span> <span class="st">"id_simu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">!=</span> <span class="st">"total"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span><span class="co"># Plot the graphic</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">energy</span>, x <span class="op">=</span> <span class="va">surface</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">stand_geom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Incident energy in MJ/m2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Type of the rays"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/graph_energies-1.png" class="r-plt" alt="" width="768"></p>
<p>For each location, the received energy on a slope equals that on a
horizontal surface when the slope is flat, whereas a south-facing slope
receives more energy and a north-facing slope receives less. In the
Northern Hemisphere, the Sun follows a daily trajectory predominantly
oriented toward the south, so tilting a surface toward the south
increases its alignment with incoming direct radiation, while tilting it
toward the north reduces exposure.</p>
<p>As discussed above, differences between locations are also evident,
with Madrid receiving much greater incident energy than Brussels and
Oslo, mainly due to a higher contribution of direct radiation. Brussels
in turn shows slightly higher incident energy than Oslo, particularly
for diffuse radiation, as confirmed by the monthly incident energy ratio
from previous graphs.</p>
</div>
<div class="section level3">
<h3 id="understand-the-discretisation-of-direct-and-diffuse-rays">Understand the discretisation of direct and diffuse rays<a class="anchor" aria-label="anchor" href="#understand-the-discretisation-of-direct-and-diffuse-rays"></a>
</h3>
<p>The discretisation of the rays are given in the
<code>output$monthly_rays$rays</code> of the <code><a href="../reference/run_sl.html">run_sl()</a></code>
function output. Direct rays (<code>direct = TRUE</code>) follow the
Sun’s annual trajectory as determined by latitude, while diffuse rays
(<code>direct = FALSE</code>) are discretized over the entire sky
hemisphere. Ray directions are defined by azimut and elevation
(<code>azimut</code> and <code>height_angle</code>, in radians), and
their incident energies (<code>e_incident</code> in MJ/m2) are derived
from monthly global radiation and diffuse-to-global ratios and
distributed according to ray geometry. Parameters relative to the
discretisation of diffuse and direct rays can be seen and tweaked from
the arguments of the advanced SamsaRaLight function :
<code>sl_run_advanced()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sl_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">monthly_rays</span><span class="op">$</span><span class="va">rays</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"id_simu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">exp_design</span>, by <span class="op">=</span> <span class="st">"id_simu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">azimut</span>, y <span class="op">=</span> <span class="va">height_angle</span>, </span>
<span>             color <span class="op">=</span> <span class="va">e_incident</span>, shape <span class="op">=</span> <span class="va">direct</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">stand_geom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/graph_rays-1.png" class="r-plt" alt="" width="700"></p>
<p>In the graph above, two distinct azimuth–elevation patterns can be
observed. Direct rays form a paraboloid-shaped distribution,
representing the Sun’s annual trajectory, whereas diffuse rays form a
regular grid of points corresponding to their discretization over the
entire sky hemisphere. The maximum elevation angle of direct rays
increases with decreasing latitude, reflecting a higher solar path over
the year and consistently higher individual ray energies for both direct
and diffuse components. Sloped surfaces allow low-elevation,
near-horizontal rays to reach the ground; however, for north-facing
slopes this results in a strong truncation toward higher azimuth angles,
primarily affecting many direct rays, while south-facing slopes exhibit
a weaker truncation toward lower azimuth angles, mainly affecting a
smaller fraction of diffuse rays.</p>
</div>
<div class="section level3">
<h3 id="consequences-in-tree-light-interception">Consequences in tree light interception<a class="anchor" aria-label="anchor" href="#consequences-in-tree-light-interception"></a>
</h3>
<p>If the user set <code>detailed_output = TRUE</code> in the
<code><a href="../reference/run_sl.html">run_sl()</a></code>function, the tree light output table
<code>output$light$trees</code> also contains light interception
variables for both direct and diffuse radiations. In the case of
absolute energy variables (<code>e</code> and <code>epot</code>), the
total energy is the sum of both direct and diffuse intercepted energies.
We can observe how the annual energy intercepted by the tree varies with
stand geometry and latitude, for both direct and diffuse rays.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dataframe for comparing intercepted energies</span></span>
<span><span class="va">out_sl_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">light</span><span class="op">$</span><span class="va">trees</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"id_simu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_simu</span>, <span class="va">id_tree</span>, e_total <span class="op">=</span> <span class="va">e</span>, <span class="va">e_direct</span>, <span class="va">e_diffuse</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">id_simu</span>, <span class="va">id_tree</span><span class="op">)</span>, </span>
<span>                      names_prefix <span class="op">=</span> <span class="st">"e_"</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"type"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"energy_intercepted"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">exp_design</span>, by <span class="op">=</span> <span class="st">"id_simu"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">!=</span> <span class="st">"total"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Plot the graphic</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">energy_intercepted</span>, x <span class="op">=</span> <span class="va">city</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">stand_geom</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Annual light intercepted energy in MJ"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Type of the rays"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="700"></p>
<p>As a direct consequence of ray discretization, which determines both
ray geometry and energy, the single tree intercepted more annual energy
on a south-facing slope than on a horizontal surface, and more than on a
north-facing slope. These differences arise primarily from the direct
radiations, as slope and aspect strongly influence the number and
orientation of direct beams reaching the canopy and the ground. In
addition, the single tree intercepted more energy in Madrid than in
Brussels and Oslo, which was amplified on south-facing slopes due to the
greater contribution of direct radiation at lower latitudes combined
with slope and aspect effects acting mainly on direct rays.</p>
</div>
<div class="section level3">
<h3 id="consequences-on-light-distribution-within-the-stand">Consequences on light distribution within the stand<a class="anchor" aria-label="anchor" href="#consequences-on-light-distribution-within-the-stand"></a>
</h3>
<p>If the user set <code>detailed_output = TRUE</code> in the
<code><a href="../reference/run_sl.html">run_sl()</a></code>function, the cell light output table
<code>output$light$cells</code> also contains light variables for both
direct and diffuse radiations. The user can <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> the
output light on the ground from total radiation (default behavior,
argument <code>energy_direct = NULL</code>), but also only from direct
energy (<code>direct_energy = TRUE</code>) or from diffuse radiations
(<code>direct_energy = FALSE</code>).</p>
<div class="section level4">
<h4 id="patterns-of-direct-and-diffuse-radiations">Patterns of direct and diffuse radiations<a class="anchor" aria-label="anchor" href="#patterns-of-direct-and-diffuse-radiations"></a>
</h4>
<p>Here we observe the shading effect of the single tree for both direct
and diffuse radiations within an example plot (Brussels, flat plane) to
show the different patterns between direct/diffuse components. We plot
here the absolute amount of energy on the ground in MJ/m2 for each of
the 10.000 1x1m cell after attenuation by the tree located in the middle
of the plot. Be careful, the color for both direct and diffuse are not
on the same scale. Also, note that in the output of this experiment, the
tree light competition index LCI is equal to 0 (i.e. no light
competition) as the tree is alone in the stand: the total energy
intercepted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>e</mi><annotation encoding="application/x-tex">e</annotation></semantics></math>
is equal to the potential energy intercepted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>p</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">epot</annotation></semantics></math>.</p>
<div class="section level5">
<h5 id="direct-radiations">Direct radiations<a class="anchor" aria-label="anchor" href="#direct-radiations"></a>
</h5>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_sl_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, what_cells <span class="op">=</span> <span class="st">"absolute"</span>, </span>
<span>     show_trees <span class="op">=</span> <span class="cn">TRUE</span>, direct_energy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" alt="" width="700"></p>
<p>For the direct ray shading effect, we observe a paraboloidal-shaped
pattern oriented toward the North (i.e., with the <code>north2x</code>
variable set to 90° when creating the virtual stand, so that the Y-axis
points to true North). This pattern reflects the annual trajectory of
the Sun. Direct rays primarily strike the tree crown from the South,
casting shadows on the ground to the North of the tree. As we move
further toward the North, East, or West, the shading effect of the tree
decreases, with the strongest gradient along the Y-axis toward the
North, because the Sun moves daily from East to West thus slightly
compensating the tree shading effect over the course of the day.</p>
</div>
<div class="section level5">
<h5 id="diffuse-radiations">Diffuse radiations<a class="anchor" aria-label="anchor" href="#diffuse-radiations"></a>
</h5>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_sl_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, what_cells <span class="op">=</span> <span class="st">"absolute"</span>, </span>
<span>     show_trees <span class="op">=</span> <span class="cn">TRUE</span>, direct_energy <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/unnamed-chunk-13-1.png" class="r-plt" alt="" width="700"></p>
<p>For the diffuse rays, we observe a symmetric pattern around the
tree—quite a pretty flower-like shape! This symmetry reflects the
discretization of diffuse rays over the entire sky hemisphere. The
slightly non-continuous appearance of the pattern results from the
coarser discretization used for diffuse rays compared to direct rays.
This reduced precision is intentional, as increasing the number of
diffuse rays would quadratically increase computation time without
significantly improving accuracy.</p>
</div>
</div>
<div class="section level4">
<h4 id="combined-effect-on-the-total-relative-energy-on-the-ground">Combined effect on the total relative energy on the ground<a class="anchor" aria-label="anchor" href="#combined-effect-on-the-total-relative-energy-on-the-ground"></a>
</h4>
<p>Comparing absolute ground energy values using a common color scale
across all modalities results in nearly uniform plots, because
variations in energy are much larger between latitudes and surface
geometries than within a single cell due to shading by an individual
tree. To highlight intra-cell variability, we therefore use the PACL
(relative) scale, which removes the dominant effects of stand geometry
and site location on ground energy. As a result, PACL provides a more
relevant proxy for assessing regeneration dynamics and visualizing shade
patterns, as it primarily reflects the shading effects of trees within
the stand rather than large-scale site effects.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get minimum PACL value </span></span>
<span><span class="va">pacl_range</span> <span class="op">&lt;-</span> <span class="va">out_sl_list</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="va">.x</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">light</span><span class="op">$</span><span class="va">cells</span><span class="op">$</span><span class="va">pacl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Store plots in a list</span></span>
<span><span class="va">plt_ground_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mod_design</span> <span class="op">&lt;-</span> <span class="va">exp_design</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Plot the stand with light outputs</span></span>
<span>  <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out_sl_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                      what_cells <span class="op">=</span> <span class="st">"relative"</span>,</span>
<span>                      show_trees <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Change some ggplot2 features</span></span>
<span>  <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">mod_design</span><span class="op">$</span><span class="va">city</span>, <span class="st">"|"</span>, <span class="va">mod_design</span><span class="op">$</span><span class="va">stand_geom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="va">pacl_range</span><span class="op">)</span></span>
<span>    </span>
<span>    </span>
<span>  <span class="co"># Fetch the legend if it is not already done</span></span>
<span>  <span class="co"># And remove the plot legend after that</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">legend</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html" class="external-link">get_legend</a></span><span class="op">(</span><span class="va">tmp_sl_plot</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    </span>
<span>  </span>
<span>  <span class="co"># Add the plot to the list</span></span>
<span>  <span class="va">plt_ground_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Gather all the plots using the cowplot package</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plt_ground_list</span>,</span>
<span>                     nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  <span class="va">legend</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="2-ray_tracing_files/figure-html/plot_pacl-1.png" class="r-plt" alt="" width="768"></p>
<p>The graph above combines the patterns observed from the ray
discretization, taking into account both stand geometry and latitude.
South-facing slopes show a stronger attenuation of direct rays
(reflected by lower PACL values in the paraboloidal-shaped pattern) at
the expense of diffuse rays, which exhibit higher PACL values in the
flower-like pattern. Latitude primarily affects the shading pattern of
direct rays: at lower latitudes, such as Madrid, shade is more
concentrated near the tree, whereas at higher latitudes, shading from
direct rays is more extended and PACL from diffuse rays is generally
lower, particularly on north-facing slopes.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
