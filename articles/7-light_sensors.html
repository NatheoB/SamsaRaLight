<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 - Add light sensors â€¢ SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="7 - Add light sensors">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-simple_case.html">1 - A first simple case</a></li>
    <li><a class="dropdown-item" href="../articles/2-stand_geometry.html">2 - Understand stand information</a></li>
    <li><a class="dropdown-item" href="../articles/3-transmission_model.html">3 - Choose the transmission model</a></li>
    <li><a class="dropdown-item" href="../articles/4-core_polygon.html">4 - Create a virtual stand from an inventory</a></li>
    <li><a class="dropdown-item" href="../articles/5-irregular_crowns.html">5 - More complex crown shapes</a></li>
    <li><a class="dropdown-item" href="../articles/7-light_sensors.html">7 - Add light sensors</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>7 - Add light sensors</h1>
            <h3 data-toc-skip class="subtitle">Estimate light arriving
toward virtual light sensors</h3>
            
      

      <div class="d-none name"><code>7-light_sensors.Rmd</code></div>
    </div>

    
    
<p>In this tutorial, we will use another real inventory called cloture20
(stored in the package and retrieved using
<code><a href="../reference/data_cloture20.html">SamsaRaLight::data_cloture20</a></code>), that comes from a project to
identify the effect of putting fences around the plot to avoid
herbivory. The inventory has been done following a specific protocol
with different concentric surveys, allowing us to consider more complex
inventory zone shapes. Moreover, relative light on the grounds has been
estimated on the field using hemispherical photographs. This will
exemplify how to estimate the relative light arriving to virtual sensors
using the <code>SamsaRaLight</code> package. Finally, to illustrate the
interest of virtual sensor, we will conduct a small experiment to
calibrate a mean leaf area density on the plot.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com" class="external-link">ggforce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for randomization reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5030</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="observe-the-inventory-zone">Observe the inventory zone<a class="anchor" aria-label="anchor" href="#observe-the-inventory-zone"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Plot the inventory zone</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">core_polygon</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"yellow"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Trees with irregular crown shapes</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_ellipse.html" class="external-link">geom_ellipse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x</span>, </span>
<span>                             y0 <span class="op">=</span> <span class="va">y</span>, </span>
<span>                             a <span class="op">=</span> <span class="op">(</span><span class="va">re_m</span> <span class="op">+</span> <span class="va">rw_m</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>                             b <span class="op">=</span> <span class="op">(</span><span class="va">rn_m</span> <span class="op">+</span> <span class="va">rs_m</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>                             angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                             fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="7-light_sensors_files/figure-html/plot_stand-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="create-the-virtual-stand">Create the virtual stand<a class="anchor" aria-label="anchor" href="#create-the-virtual-stand"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_stand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_rect_stand.html">create_rect_stand</a></span><span class="op">(</span></span>
<span>  trees <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">core_polygon</span>,</span>
<span>  fill_around <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-the-virtual-stand-with-sensors">Prepare the virtual stand with sensors<a class="anchor" aria-label="anchor" href="#prepare-the-virtual-stand-with-sensors"></a>
</h2>
<div class="section level3">
<h3 id="sensors-dataset-format">Sensors dataset format<a class="anchor" aria-label="anchor" href="#sensors-dataset-format"></a>
</h3>
<p>Mandatory varables are id_sensor unique integer, the sensor
coordinates (x, y) in the virtual stand and the height of the sensor h_m
in meters. Here we have the output pacl of the sensors, but the
SamsaraLight model do not use it. We will use them in order to compare
with the estimated PACL from the SamsaraLight model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">sensors</span></span>
<span><span class="co">#&gt;    id_sensor     x     y h_m pacl pacl_direct pacl_diffuse</span></span>
<span><span class="co">#&gt; 1          1 22.00 56.64   2 0.11        0.13         0.10</span></span>
<span><span class="co">#&gt; 2          2 71.22 53.45   3 0.22        0.28         0.16</span></span>
<span><span class="co">#&gt; 3          3 75.30 53.45   3 0.26        0.31         0.21</span></span>
<span><span class="co">#&gt; 4          4 71.22 45.27   3 0.15        0.13         0.16</span></span>
<span><span class="co">#&gt; 5          5 71.22 37.21   3 0.13        0.08         0.17</span></span>
<span><span class="co">#&gt; 6          6 56.88 37.21   3 0.18        0.12         0.22</span></span>
<span><span class="co">#&gt; 7          7 68.11 24.30   2 0.27        0.29         0.24</span></span>
<span><span class="co">#&gt; 8          8 57.84 22.00   3 0.18        0.21         0.15</span></span>
<span><span class="co">#&gt; 9          9 57.84 26.11   3 0.10        0.12         0.09</span></span>
<span><span class="co">#&gt; 10        10 67.34 53.45   3 0.21        0.26         0.17</span></span>
<span><span class="co">#&gt; 11        11 22.00 64.82   3 0.17        0.20         0.15</span></span>
<span><span class="co">#&gt; 12        12 25.97 64.82   3 0.19        0.24         0.15</span></span>
<span><span class="co">#&gt; 13        13 25.97 68.74   3 0.12        0.09         0.14</span></span>
<span><span class="co">#&gt; 14        14 28.08 74.86   3 0.11        0.03         0.18</span></span>
<span><span class="co">#&gt; 15        15 32.00 68.74   3 0.12        0.07         0.17</span></span>
<span><span class="co">#&gt; 16        16 28.08 64.82   3 0.15        0.18         0.13</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="important-shift-the-sensors-coordinates">IMPORTANT: shift the sensors coordinates<a class="anchor" aria-label="anchor" href="#important-shift-the-sensors-coordinates"></a>
</h3>
<p>However, we have used the function <code><a href="../reference/create_rect_stand.html">create_rect_stand()</a></code>
that shifted the coordinates of the inventory to include it inside a
rectangle virtual stand. Thus, do not forget to also apply the shift to
the sensors coordinates.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_sensors</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">sensors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">shift_x</span>,</span>
<span>                y <span class="op">=</span> <span class="va">y</span> <span class="op">+</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">shift_y</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="observe-sensors-within-the-virtual-stand">Observe sensors within the virtual stand<a class="anchor" aria-label="anchor" href="#observe-sensors-within-the-virtual-stand"></a>
</h3>
<p>For the sake of the representation, we draw the sensor as a large
square.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Plot the inventory zone</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">inv_zone_df</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"yellow"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Trees with irregular crown shapes</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_ellipse.html" class="external-link">geom_ellipse</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">trees</span>,</span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x</span>, </span>
<span>                             y0 <span class="op">=</span> <span class="va">y</span>, </span>
<span>                             a <span class="op">=</span> <span class="op">(</span><span class="va">re_m</span> <span class="op">+</span> <span class="va">rw_m</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>                             b <span class="op">=</span> <span class="op">(</span><span class="va">rn_m</span> <span class="op">+</span> <span class="va">rs_m</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>                             angle <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                             fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Add the sensors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sensors</span>,</span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">2</span>,</span>
<span>                          ymin <span class="op">=</span> <span class="va">y</span> <span class="op">-</span> <span class="fl">2</span>,</span>
<span>                          xmax <span class="op">=</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">2</span>,</span>
<span>                          ymax <span class="op">=</span> <span class="va">y</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"gray"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_sensors</span>, </span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">id_sensor</span><span class="op">)</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="7-light_sensors_files/figure-html/plot_sensors-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="estimate-light-arriving-to-the-sensors">Estimate light arriving to the sensors<a class="anchor" aria-label="anchor" href="#estimate-light-arriving-to-the-sensors"></a>
</h2>
<div class="section level3">
<h3 id="run-samsaralight">Run SamsaraLight<a class="anchor" aria-label="anchor" href="#run-samsaralight"></a>
</h3>
<p>To inform the SamsaraLight model on the sensors we want to compute
light interception, we have to provide our sensor data.frame with the
<code>sensors</code> argument. In addition, we can decide to compute
light interception ONLY on the sensors, and not on trees and cells
(setting <code>sensors_only = TRUE</code>), which greatly reduces the
computation time as rays are casted only towards the sensors, and not
toward the center of each cell.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_out_sensors</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/sl_run.html">sl_run</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co"># Trees</span></span>
<span>  trees <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">trees</span>, </span>
<span>  </span>
<span>  <span class="co"># Sensors</span></span>
<span>  sensors <span class="op">=</span> <span class="va">data_sensors</span>,</span>
<span>  sensors_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  </span>
<span>  <span class="co"># Radiations</span></span>
<span>  monthly_rad <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">radiations</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  </span>
<span>  <span class="co"># Stand geometry</span></span>
<span>  slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"slope"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"aspect"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  north_to_x_cw <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"north_to_x_cw"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">cell_size</span>, </span>
<span>  n_cells_x <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_x</span>, </span>
<span>  n_cells_y <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_y</span>,</span>
<span>  </span>
<span>  <span class="co"># Consider a turbid medium as the transmission model (default is TRUE)</span></span>
<span>  turbid_medium <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  </span>
<span>  <span class="co"># Use a torus system for representing plot edges (default to TRUE)</span></span>
<span>  use_torus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  </span>
<span>  <span class="co"># Consider trunk interception (default is TRUE)</span></span>
<span>  trunk_interception <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="observe-sensors-on-the-light-map">Observe sensors on the light map<a class="anchor" aria-label="anchor" href="#observe-sensors-on-the-light-map"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sl_output.html">plot_sl_output</a></span><span class="op">(</span><span class="va">sl_out_sensors</span>,</span>
<span>               trees.fill <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>               cells.fill <span class="op">=</span> <span class="st">"pacl"</span>,</span>
<span>               cells.fill.palette <span class="op">=</span> <span class="st">"light01"</span>,</span>
<span>               sensors.plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="7-light_sensors_files/figure-html/unnamed-chunk-7-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="compare-observed-with-estimated-pacl">Compare observed with estimated PACL<a class="anchor" aria-label="anchor" href="#compare-observed-with-estimated-pacl"></a>
</h3>
<p>The estimated light arriving to the sensors is stored in the
<code>$output$sensors</code> object, and the format is the same as for
the cells output. The difference is that cells nergy is estimated on the
slope, whereas sensor output energy is computed as arriving on a
horizontal plane.</p>
<p>We can compare the estimated PACL with the measured one on the
field:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="va">data_sensors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_sensor</span>, <span class="va">pacl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="st">"id_sensor"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_obs"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">sl_out_sensors</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">sensors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_sensor</span>, <span class="va">pacl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="st">"id_sensor"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_pred"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  by <span class="op">=</span> <span class="st">"id_sensor"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    diff_pacl <span class="op">=</span> <span class="va">pacl_obs</span> <span class="op">-</span> <span class="va">pacl_pred</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">pacl_pred</span>, x <span class="op">=</span> <span class="va">pacl_obs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, color <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"skyblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Observed PACL from field data"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Predicted PACL with virtual sensors in SamsaraLight"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison between PACL from field sensors and predicted with SamsaraLight"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"red line is a linear regression and blue line is the 1,1 control line for perfect fit"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="7-light_sensors_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="a-first-approach-for-lad-calibration">A first approach for LAD calibration<a class="anchor" aria-label="anchor" href="#a-first-approach-for-lad-calibration"></a>
</h2>
<p>Above, the LAD parameter has been set to 0.5. Field sensors can be
used to calibrate the tree leaf area density, an important parameter
that controls the amount of light arriving on the ground.</p>
<p>To do so, a first approach could be to found a mean speciesâ€™ LAD
value that minimize the mean residuals between observed and predicted
total PACL.</p>
<div class="section level3">
<h3 id="run-samsaralight-with-different-lads">Run SamsaraLight with different LADs<a class="anchor" aria-label="anchor" href="#run-samsaralight-with-different-lads"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LADs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">LADs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">time_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">lad</span> <span class="kw">in</span> <span class="va">LADs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lad</span><span class="op">)</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span><span class="op">+</span><span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co"># Set the tested LAD value</span></span>
<span>  <span class="va">inv_test</span> <span class="op">&lt;-</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">trees</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>crown_lad <span class="op">=</span> <span class="va">lad</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># Run SamsaraLight</span></span>
<span>  <span class="va">sl_out_sensors_test</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/sl_run.html">sl_run</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># Trees</span></span>
<span>    trees <span class="op">=</span> <span class="va">inv_test</span>, </span>
<span>    </span>
<span>    <span class="co"># Sensors</span></span>
<span>    sensors <span class="op">=</span> <span class="va">data_sensors</span>,</span>
<span>    sensors_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    </span>
<span>    <span class="co"># Radiations</span></span>
<span>    monthly_rad <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">radiations</span>,</span>
<span>    latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>    </span>
<span>    <span class="co"># Stand geometry</span></span>
<span>    slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"slope"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>    aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"aspect"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>    north_to_x_cw <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"north_to_x_cw"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    cell_size <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">cell_size</span>, </span>
<span>    n_cells_x <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_x</span>, </span>
<span>    n_cells_y <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_y</span>,</span>
<span>    </span>
<span>    <span class="co"># Consider a turbid medium as the transmission model (default is TRUE)</span></span>
<span>    turbid_medium <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    </span>
<span>    <span class="co"># Use a torus system for representing plot edges (default to TRUE)</span></span>
<span>    use_torus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    </span>
<span>    <span class="co"># Consider trunk interception (default is TRUE)</span></span>
<span>    trunk_interception <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># Compute the mean residuals</span></span>
<span>  <span class="va">out_residuals</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>    </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>      </span>
<span>      <span class="va">data_sensors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_sensor</span>, <span class="va">pacl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="st">"id_sensor"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_obs"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="va">sl_out_sensors_test</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">sensors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_sensor</span>, <span class="va">pacl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="op">-</span><span class="st">"id_sensor"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"_pred"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      by <span class="op">=</span> <span class="st">"id_sensor"</span></span>
<span>      </span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      res <span class="op">=</span> <span class="va">pacl_obs</span> <span class="op">-</span> <span class="va">pacl_pred</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lad <span class="op">=</span> <span class="va">lad</span>, .before <span class="op">=</span> <span class="va">res</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">time_end</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">time_elapsed</span> <span class="op">&lt;-</span> <span class="va">time_end</span> <span class="op">-</span> <span class="va">time_start</span></span>
<span></span>
<span><span class="va">out_residuals</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">out_residuals</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Testing"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">LADs</span><span class="op">)</span>, <span class="st">"LAD values"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Testing 2000 LAD values"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">time_elapsed</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time difference of 4.12793 mins</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="find-the-optimised-lad">Find the optimised LAD<a class="anchor" aria-label="anchor" href="#find-the-optimised-lad"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_lad</span> <span class="op">&lt;-</span> <span class="va">out_residuals</span><span class="op">$</span><span class="va">lad</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">out_residuals</span><span class="op">$</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">text_best_lad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">best_lad</span><span class="op">)</span>,</span>
<span>                          gp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">13</span>, fontface<span class="op">=</span><span class="st">"bold"</span>,</span>
<span>                                  col <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>The optimized mean LAD appeared to be 0.775, which indicates that the
default value of 0.5 was relevant.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out_residuals</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">res</span>, x <span class="op">=</span> <span class="va">lad</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, color <span class="op">=</span> <span class="st">"darkgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">best_lad</span>, color <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html" class="external-link">annotation_custom</a></span><span class="op">(</span><span class="va">text_best_lad</span>, </span>
<span>                    xmin<span class="op">=</span><span class="va">best_lad</span>, xmax<span class="op">=</span><span class="va">best_lad</span>, </span>
<span>                    ymin<span class="op">=</span><span class="op">-</span><span class="fl">0.97</span>, ymax<span class="op">=</span><span class="op">-</span><span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Residuals between observed and predicted PACL"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Leaf area density LAD"</span><span class="op">)</span></span></code></pre></div>
<p><img src="7-light_sensors_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
