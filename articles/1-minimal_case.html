<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1 - A first minimal case • SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="1 - A first minimal case">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-minimal_case.html">1 - A first minimal case</a></li>
    <li><a class="dropdown-item" href="../articles/2-discretisation_directdiffuse.html">2 - Understand ray discretization with detailed output</a></li>
    <li><a class="dropdown-item" href="../articles/3-complex_crowns.html">3 - More complex crown shapes</a></li>
    <li><a class="dropdown-item" href="../articles/4-complex_inventory.html">4 - More complex inventory shapes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>1 - A first minimal case</h1>
            <h3 data-toc-skip class="subtitle">Compute tree light
interception by symmetric crowns in an axis-aligned rectangle plot</h3>
            
      

      <div class="d-none name"><code>1-minimal_case.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>  collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  comment <span class="op">=</span> <span class="st">"#&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This is the first tutorial, showing you how to solve a basic problem
using the SamsaRaLight package. We will demonstrate this with the
Prenovel dataset, which is stored in the package as
<code><a href="../reference/data_prenovel.html">SamsaRaLight::data_prenovel</a></code>. This dataset represents an
uneven-aged stand of fir, spruce and beech located in the Jura mountains
in France. You can find more information in the data documentation. We
used this dataset as a minimal example this comes from a “marteloscope”
exercise, that is a plot used for harvesting exercises on the field. The
trees are inventoried inside a formalised 1-ha squared plot (100m*100m),
thus being the easier inventory for using the SamsaRaLight package. In
the next tutorials, we explain the case where trees are not inventoried
in a formalized rectangle plot (4 - Create a virtual stand from more
complex tree inventory).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h2>
<div class="section level3">
<h3 id="format-the-tree-inventory">Format the tree inventory<a class="anchor" aria-label="anchor" href="#format-the-tree-inventory"></a>
</h3>
<p>The user needs to define the individual trees composing the stand
with their crown dimensions. The data frame must be created with a
specific format and variables. See documentation using
<code>?SamsaRaLight::check_inventory()</code> to understand the format
of the trees dataset, and validate it using the same function.</p>
<p>The dataframe must contain mandatory information about the trees: a
unique integer id (<code>id_tree</code>), the species name
(<code>species</code>), coordinates in meters (<code>x</code>,
<code>y</code>) and diameter at breast height in cm
(<code>dbh_cm</code>). The x and y coordinates must be given in meters
on a flat plane (not considering slope), and the z coordinate will be
computed automatically during the process from stand geometry. Be
careful, you cannot use longitude/latitude (WGS84 coordinates system),
as it is angular coordinates, thus not representing correctly relative
distance between each tree. Consider converting the coordinates in a
planar reference system such as local UTM. See the Tutorial 4 for an
example on how to use SamsaRaLight from trees inventoried with GPS data
giving long/lat coordinates (4 - Create a virtual stand from more
complex tree inventory).</p>
<p>In this tutorial, we represent the tree crowns with simple shapes,
defined in the <code>crown_type</code> column by a specific code: “E”
(for an ellipsoid) or “P” (for a paraboloid). The ellipsoidal shape “E”
is commonly used for broadleaved species, whereas a paraboloidal shape
“P” is commonly used for conifers. When using simple crown shapes, the
user must provide only 3 values to define the crown dimensions: the
height of the tree (<code>h_m</code> in meters), the height of the base
of the crown (<code>hbase_m</code> in meters) and the crown maximum
radius that is the same is the four cardinal directions as we consider
simple symmetric crowns (<code>rn_m</code>, <code>re_m</code>,
<code>rs_m</code> and <code>rw_m</code>, all in meters). When
considering those type of simple crown shapes (“E” or “P”), the user
must not provide the <code>hmax_m</code> variable, which is the height
at which the crown radius is maximum. Indeed, it is automatically
computed during the process, being set to the crown base height
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>=</mo><mi>h</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">hmax = hbase</annotation></semantics></math>)
when considering a paraboloidal shape “P”, and set at the middle of the
crown for an ellipsoidal shape “E”
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo>=</mo><mi>h</mi><mo>−</mo><mn>0.5</mn><mo>*</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>h</mi><mo>−</mo><mi>h</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">hmax = h - 0.5*(h - hbase)</annotation></semantics></math>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_trees_inv</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">trees</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">input_trees_inv</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id_tree    species       x       y  dbh_cm crown_type     h_m hbase_m hmax_m</span></span>
<span><span class="co">#&gt; 1       1 Abies alba 77.7336 71.0808 22.9320          P 14.8120  3.3073     NA</span></span>
<span><span class="co">#&gt; 2       2 Abies alba 62.5783 65.1864 18.2397          P 12.9612  4.7429     NA</span></span>
<span><span class="co">#&gt; 3       3 Abies alba 84.0060 95.2483 22.8472          P 15.8187  4.9055     NA</span></span>
<span><span class="co">#&gt; 4       4 Abies alba 58.9521 97.9011 19.1539          P 11.7033  4.2050     NA</span></span>
<span><span class="co">#&gt; 5       5 Abies alba 33.3423 39.4053 19.8852          P 14.6597  3.8346     NA</span></span>
<span><span class="co">#&gt; 6       6 Abies alba 57.5743  2.0656 20.1293          P 16.6530  7.6860     NA</span></span>
<span><span class="co">#&gt;     rn_m   re_m   rs_m   rw_m crown_openness crown_lad</span></span>
<span><span class="co">#&gt; 1 3.0204 3.0204 3.0204 3.0204            0.2     0.767</span></span>
<span><span class="co">#&gt; 2 3.0896 3.0896 3.0896 3.0896            0.2     0.767</span></span>
<span><span class="co">#&gt; 3 2.8350 2.8350 2.8350 2.8350            0.2     0.767</span></span>
<span><span class="co">#&gt; 4 2.5196 2.5196 2.5196 2.5196            0.2     0.767</span></span>
<span><span class="co">#&gt; 5 2.8208 2.8208 2.8208 2.8208            0.2     0.767</span></span>
<span><span class="co">#&gt; 6 3.2436 3.2436 3.2436 3.2436            0.2     0.767</span></span>
<span></span>
<span><span class="co"># Check the format of the inventory table</span></span>
<span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/check_inventory.html">check_inventory</a></span><span class="op">(</span><span class="va">input_trees_inv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inventory table successfully validated.</span></span></code></pre></div>
<p>The user can observe its validated inventory using the function
<code><a href="../reference/plot_inventory.html">SamsaRaLight::plot_inventory()</a></code>. Computation time can be
long as the trees are plotted in order of tree height to well represent
the vertical structure of the stand.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_inventory.html">plot_inventory</a></span><span class="op">(</span><span class="va">input_trees_inv</span><span class="op">)</span></span></code></pre></div>
<p><img src="1-minimal_case_files/figure-html/plot_inventory-1.png" class="r-plt" alt="" width="700"></p>
<p>In the next tutorials, we will explain more in details the columns
<code>crown_openness</code>/<code>crown_lad</code> (3 - Choose the
transmission model) and consider more complex, asymmetric crown shapes
(5 - Represent the crowns with more complex shapes).</p>
</div>
<div class="section level3">
<h3 id="create-the-samsaralight-input-stand">Create the SamsaRaLight input stand<a class="anchor" aria-label="anchor" href="#create-the-samsaralight-input-stand"></a>
</h3>
<p>The SamsaraLight ray-tracing model needs to be run on a axis-aligned
rectangle stand that is split into square cells, with a given
homogeneous slope, orientation and aspect. Moreover, the user needs to
precise the plot latitude (Y-axis in WGS84 in degrees) as the model
considers that light rays’ geometry vary with plot latitude, discussed
further in the Tutorial 2 (2 - Understand ray-tracing).</p>
<p>The package provides a function that creates a standardized
SamsaRaLight virtual stand as a <code>sl_stand</code> R S3 object:
<code><a href="../reference/create_sl_stand.html">SamsaRaLight::create_sl_stand()</a></code>. This function needs 5
mandatory arguments: the tree inventory table (<code>tree_inv</code>,
formatted as described above), the size of the square cell that split
the rectangle SamsaRaLight stand (<code>cell_size</code> in meters), the
plot latitude (<code>latitude</code>) and three variables defining the
plane stand geometry (<code>slope</code>, <code>aspect</code> and
<code>north2x</code>, all in degrees). The function checks internally
that all arguments are correct and well formatted (set the argument
<code>verbose = FALSE</code> to avoid success messages).</p>
<p>Optionally but essential here to well define your virtual stand from
the tree inventory, the user can define the inventory zone with the
argument <code>core_polygon_df</code>. The polygon is defined by a
data.frame that contains the relative coordinates <code>x</code> and
<code>y</code> of the vertices of the zone where the trees have been
inventoried.</p>
<p>The <code>cell_size</code> argument defines the precision of the
SamsaRaLight ray-tracing model. The ray-tracing model will casts rays
towards the center of each cell and estimate the light arriving to this
cell after attenuation by tree crowns and the smaller the cells are
defined, the more rays the model casts per m2. The default
<code>cell_size</code> is 10, leading to very fast computation time. The
user can go towards the maximum precision which is 1 (1m*1m square
cells) to produce high-resolution shading maps (see the end of this
tutorial), but will lead to much heavier computation time and memory
use. Indeed, computation time is not proportional to
<code>cell_size</code> but rather quadratic: the number of cells in the
plot increases quadratically with the cell size, and also consequently
is the total number of cast rays during the simulation (which is the
main factor for computation time and memory use).</p>
<p>The <code>north2x</code> argument is the angle from North to X-axis
(clockwise), thus defining the rotation of real North (tree inventory)
relative to the virtual plot X-axis (SamsaRaLight stand). The default
90° corresponds to a Y-axis oriented toward true North (0°: x-axis
points North, 90° : x-axis points East, 180° : x-axis points South, 270°
: x-axis points West). The <code>slope</code> and <code>aspect</code>
arguments define the geometry in case of a non-plane stand, with the
aspect variable representing the direction the slope faces downhill,
defined by the angle of the steepest downslope direction measured
clockwise from true North (0°: North-facing slope, East-facing slope:
90°, 180°: South-facing slope, 270°: West-facing slope). The Tutorial 2
(2 - Understand ray-tracing) also shows how the light on the ground
varies with stand geometry.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">input_sl_stand</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co"># Tree inventory formatted table</span></span>
<span>  trees_inv <span class="op">=</span> <span class="va">input_trees_inv</span>,</span>
<span>  </span>
<span>  <span class="co"># Precision of the SamsaRaLight model</span></span>
<span>  cell_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  </span>
<span>  <span class="co"># Stand information</span></span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>  aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>  north2x <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">north2x</span>,</span>
<span>  </span>
<span>  <span class="co"># Definition of the inventory zone definition</span></span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">core_polygon</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span></code></pre></div>
<p>The user can observe the creating SamsaRaLight virtual stand object
(<code>sl_stand</code> S3 object) using the base functions
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.
The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function allows to observe the stand in two
views: a stand map with circles representing the located maximum crown
radius of trees from above, or a top-down plot mainly showing heights of
crowns and trunks from a South-view (facing North) and a East-view
(facing West).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">input_sl_stand</span><span class="op">)</span></span>
<span><span class="co">#&gt; SamsaRaLight stand of 1 ha with 333 trees and 0 sensors (100 x 100 cells, 1 m)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">input_sl_stand</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SamsaRaLight stand summary</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inventory (core polygon):</span></span>
<span><span class="co">#&gt;   Area              : 1.00 ha</span></span>
<span><span class="co">#&gt;   Trees             : 333</span></span>
<span><span class="co">#&gt;   Density           : 333.0 trees/ha</span></span>
<span><span class="co">#&gt;   Basal area        : 35.41 m2/ha</span></span>
<span><span class="co">#&gt;   Quadratic mean DBH: 36.8 cm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation stand (core + filled buffer):</span></span>
<span><span class="co">#&gt;   Area              : 1.00 ha</span></span>
<span><span class="co">#&gt;   Trees             : 333</span></span>
<span><span class="co">#&gt;   Density           : 333.0 trees/ha</span></span>
<span><span class="co">#&gt;   Basal area        : 35.41 m2/ha</span></span>
<span><span class="co">#&gt;   Quadratic mean DBH: 36.8 cm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Stand geometry:</span></span>
<span><span class="co">#&gt;   Grid              : 100 x 100 (10000 cells)</span></span>
<span><span class="co">#&gt;   Cell size         : 1.00 m</span></span>
<span><span class="co">#&gt;   Slope             : 6.00 deg</span></span>
<span><span class="co">#&gt;   Aspect            : 144.00 deg</span></span>
<span><span class="co">#&gt;   North to X-axis   : 54.00 deg</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of sensors: 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Available light interception models:</span></span>
<span><span class="co">#&gt;   - Turbid medium (crown_lad)</span></span>
<span><span class="co">#&gt;   - Porous envelope (crown_openness)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">input_sl_stand</span><span class="op">)</span></span></code></pre></div>
<p><img src="1-minimal_case_files/figure-html/plot_sl_stand-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">input_sl_stand</span>, top_down <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="1-minimal_case_files/figure-html/plot_sl_stand_topdown-1.png" class="r-plt" alt="" width="700"></p>
<p>In the next tutorials, we explain how to create a virtual stand where
trees are not inventoried directly in an axis-aligned rectangle plot (4
- Create a virtual stand from more complex tree inventory).</p>
</div>
<div class="section level3">
<h3 id="monthly-radiations">Monthly radiations<a class="anchor" aria-label="anchor" href="#monthly-radiations"></a>
</h3>
<p>The user needs to define in a data frame the monthly energy specific
to its plot location. For each month (represented by an integer number
between 1 and 12), one needs to inform
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mi>r</mi><mi>a</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">Hrad</annotation></semantics></math>
as the global monthly energies (in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>J</mi><mi>.</mi><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">MJ.m^{-2}</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>G</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">DGratio</annotation></semantics></math>
as the ratio of diffuse energy relative to global energy (needed to
represent the proportion of diffuse and direct energy). The
discretization of diffuse and direct rays from the given radiation
dataset is discussed in the next tutorial (2 - Understand
ray-tracing).</p>
<p>This data frame can be automatically constructed using the
SamsaRaLight function
<code><a href="../reference/get_monthly_radiations.html">SamsaRaLight::get_monthly_radiations()</a></code>, given the latitude
and longitude of the plot. It gets radiation data from the PVGIS
European database but needs an Internet connection. Otherwise, the
monthly radiation data frame used in this tutorial (Prenovel stand) is
stored within the package and can be retrieved using
<code>SamsaRaLight::data_prenovel$radiations</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the monthly radiation data frame</span></span>
<span><span class="va">input_monthly_radiations</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/get_monthly_radiations.html">get_monthly_radiations</a></span><span class="op">(</span></span>
<span>  <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>, </span>
<span>  <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">longitude</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">input_monthly_radiations</span></span>
<span><span class="co">#&gt;    month     Hrad  DGratio</span></span>
<span><span class="co">#&gt; 1      1 137.0902 0.580625</span></span>
<span><span class="co">#&gt; 2      2 206.3025 0.506875</span></span>
<span><span class="co">#&gt; 3      3 353.8260 0.493125</span></span>
<span><span class="co">#&gt; 4      4 465.8220 0.490000</span></span>
<span><span class="co">#&gt; 5      5 535.2458 0.508750</span></span>
<span><span class="co">#&gt; 6      6 618.1785 0.463750</span></span>
<span><span class="co">#&gt; 7      7 655.1730 0.425000</span></span>
<span><span class="co">#&gt; 8      8 557.6332 0.436250</span></span>
<span><span class="co">#&gt; 9      9 423.9382 0.446875</span></span>
<span><span class="co">#&gt; 10    10 280.2780 0.475000</span></span>
<span><span class="co">#&gt; 11    11 157.9635 0.538750</span></span>
<span><span class="co">#&gt; 12    12 116.4960 0.587500</span></span>
<span></span>
<span><span class="co"># Check that it the format is correct</span></span>
<span><span class="fu"><a href="../reference/check_monthly_radiations.html">check_monthly_radiations</a></span><span class="op">(</span><span class="va">input_monthly_radiations</span><span class="op">)</span></span>
<span><span class="co">#&gt; Radiation table successfully validated.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="run-samsaralight">Run SamsaRaLight<a class="anchor" aria-label="anchor" href="#run-samsaralight"></a>
</h2>
<p>From now, you can easily run the SamsaraLight ray-tracing model using
the function <code><a href="../reference/run_sl.html">run_sl()</a></code> from the only two mandatory
arguments: the created SamsaRaLight virtual stand object
<code>sl_stand</code> and the monthly radiations table
<code>monthly_radiations</code>.</p>
<p>The <code>use_torus</code> argument is essential to account for the
lack of information about trees surrounding the inventory zone. When set
to TRUE (default), the stand is treated as an infinite plot, where the
inventoried trees are surrounded by identical copies of the stand. When
set to FALSE, the stand is assumed to be bordered by grasslands without
trees, which may bias light interception estimates, particularly near
the edges of the virtual stand. Thus, set the <code>use_torus</code>
argument to FALSE only if it is biologically consistent, such as a stand
in the middle of a clear-cut or surrounded by fields and roads.</p>
<p>The package SamsaRaLight allows for running the simulation in
parallel setting the argument <code>parallel_mode = TRUE</code>. When
activating the parallel_mode, the simulation will take by default all
the internal threads that are avaikable, but the user can decide how
many cores to dedicate to the simulation with the argument
<code>n_threads</code>. During the simulation, a message will appear to
specify to the user how many cores are used by the simulation, and how
many are available with the device, but the user can silence those
messages with <code>verbose = TRUE</code> argument. The parallelisation
is done internally across independent cells, while running sequentially
each ray for a given cell. By doing so, the parallel mode is even
essential when the number of cells is large. Parallelisation is done
using OpenMP, but on platforms or compilers that do not support OpenMP,
parallelisation is disabled and computations run in sequential mode
(i.e. <code>parallel_mode = FALSE</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_output</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/run_sl.html">run_sl</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># Mandatory arguments</span></span>
<span>    sl_stand <span class="op">=</span> <span class="va">input_sl_stand</span>,</span>
<span>    monthly_radiations <span class="op">=</span> <span class="va">input_monthly_radiations</span>,</span>
<span>    </span>
<span>    <span class="co"># Surrounding environment</span></span>
<span>    use_torus <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    </span>
<span>    <span class="co"># Parallelisation arguments</span></span>
<span>    parallel_mode <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    n_threads <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in sl_set_openmp(parallel_mode, as.integer(n_threads)): OpenMP not</span></span>
<span><span class="co">#&gt; available: running sequentially.</span></span>
<span><span class="co">#&gt; parallel mode disabled because OpenMP was not available</span></span>
<span><span class="co">#&gt; SamsaRaLight simulation was run successfully.</span></span></code></pre></div>
<p>For advanced users, an internal function is available using
<code>SamsaRaLight:::run_sl_advanced()</code> allowing to control deeper
ray-tracing parameters. The user-friendly function
<code><a href="../reference/run_sl.html">SamsaRaLight::run_sl()</a></code> internally wrap the advenced version
with default parameters. In the tutorials, we will not adress this
advanced function, but all parameters with default values can be find
following the documentation of this function. Otherwise, feel free to
contact the main authors for a deeper use of the package and the
model.</p>
</div>
<div class="section level2">
<h2 id="simulation-output">Simulation output<a class="anchor" aria-label="anchor" href="#simulation-output"></a>
</h2>
<p>The output is a complex S3 R object, with first a list of two
elements: <code>$input</code> (that gathers inputs of the model defined
above <code>$input$sl_stand</code> and
<code>$input$monthly_radiations</code>, associated to the parameters of
the simulation <code>$input$params</code>) and <code>$output</code> that
essentially contains output light variables at the tree-level
<code>output$light$trees</code> and at the cell-level
<code>output$light$cells</code>. You can also observe
<code>output$light$sensors</code> that are the light output at a located
virtual light sensor, but this is discussed in the Tutorial 6 (6 - Add
virtual sensors on the ground). Optionnaly, the user can set the
<code><a href="../reference/run_sl.html">run_sl()</a></code> function argument <code>detailed_output</code> to
TRUE in order to have more information about the rays discretisation and
interceptions, but it is also discussed further in the next tutorial (2
- Understand ray-tracing). In this tutorial, we will focus here on both
the tree- and cell-level output light variables, stored in
<code>output$light</code>.</p>
<p>The object <code>$output$cells</code> contains output light variables
for each cell, identified by its unique id (<code>id_cell</code>, linked
to the input cell dataframe <code>sl_output$input$sl_stand$cells</code>
to retrive cell center coordinates). There are 3 output variables, which
are <code>e</code> (for the energy arriving on the cell in MJ/m2),
<code>pacl</code> (for proportion of above light canopy, which is the
ratio between the energy arriving on the cell and the energy before
interception by the trees) and <code>punobs</code> (for the proportion
of energy on the cell that comes from unobstructed rays, i.e. rays that
have not been intercepted by any trees).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sl_output</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">light</span><span class="op">$</span><span class="va">cells</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    10000 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ id_cell: int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ e      : num  478 532 522 505 488 ...</span></span>
<span><span class="co">#&gt;  $ pacl   : num  0.105 0.117 0.115 0.111 0.107 ...</span></span>
<span><span class="co">#&gt;  $ punobs : num  0.308 0.377 0.473 0.406 0.329 ...</span></span></code></pre></div>
<p>The object <code>$output$trees</code> contains output light variables
for each trees, identified by its unique id (<code>id_tree</code>).
There are 4 output variables, which are <code>e</code> (for the total
energy intercepted by the tree in MJ), <code>epot</code> (for the
potential energy intercepted by the tree without considering its
neighbors in MJ, i.e. the total energy intercepted if the tree was alone
with the same crown dimensions),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>c</mi><mi>i</mi><mo>=</mo><mn>1</mn><mo>−</mo><mi>e</mi><mi>/</mi><mi>e</mi><mi>p</mi><mi>o</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">lci = 1 - e/epot</annotation></semantics></math>
(which is a light competition index and a good proxy for tree dynamics,
see Beauchamp et al. 2025, representing the real intercepted energy
compared to the potential energy it could intercept without competition)
and <code>punobs</code> (for the proportion of energy intercepted by the
tree that comes from unobstructed rays, i.e. rays that have not been
intercepted by any other trees).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sl_output</span><span class="op">$</span><span class="va">output</span><span class="op">$</span><span class="va">light</span><span class="op">$</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    333 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ id_tree: int  116 92 46 273 176 4 272 157 89 29 ...</span></span>
<span><span class="co">#&gt;  $ epot   : num  387315 253854 203071 76454 221087 ...</span></span>
<span><span class="co">#&gt;  $ e      : num  115800 96237 56293 15399 9713 ...</span></span>
<span><span class="co">#&gt;  $ lci    : num  0.701 0.621 0.723 0.799 0.956 ...</span></span>
<span><span class="co">#&gt;  $ eunobs : num  83985 81000 45459 10109 1318 ...</span></span></code></pre></div>
<p>The user can observe the output of the SamsaRaLight simulation object
(<code>sl_output</code> S3 object) using the base functions
<code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.
The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function allows to observe the stand map with
tree- and cell-level colouring depending on the output light variables.
By default, the plot shows the light competition index LCI for trees and
the relative light on the ground PACL for cells, as there are good
proxies for estimating tree and stand dynamics. In addition, the
argument <code>show_trees</code> can be set to FALSE to plot only a
shade map as a nice plot for representing the understorey light. Light
variables to plot can be defined independently for both trees and cells
by setting <code>what_trees</code> and <code>what_cells</code>
arguments. For example, setting <code>what_trees = "intercepted"</code>
and <code>what_cells = "absolute</code> allows to better catch the
differences in light energies between trees and cells. However, be
careful about the colours of the cells, white areas do no mean cells in
high-light but brighter cells relatively to the others, it could be
confusing without precise legend…</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sl_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; SamsaRaLight output with 10000 cells, 333 trees and 0 sensors (no detailed output)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sl_output</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SamsaRaLight simulation summary</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Trees (crown interception)</span></span>
<span><span class="co">#&gt; ---------------------------</span></span>
<span><span class="co">#&gt;       epot               e                 lci         </span></span>
<span><span class="co">#&gt;  Min.   :   6930   Min.   :   861.8   Min.   :0.06625  </span></span>
<span><span class="co">#&gt;  1st Qu.: 153986   1st Qu.: 23681.0   1st Qu.:0.56729  </span></span>
<span><span class="co">#&gt;  Median : 282894   Median : 67855.4   Median :0.71628  </span></span>
<span><span class="co">#&gt;  Mean   : 311514   Mean   :116322.6   Mean   :0.68980  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 444481   3rd Qu.:178181.5   3rd Qu.:0.84023  </span></span>
<span><span class="co">#&gt;  Max.   :1003557   Max.   :728911.8   Max.   :0.98942  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cells (ground light)</span></span>
<span><span class="co">#&gt; -------------------</span></span>
<span><span class="co">#&gt;        e               pacl             punobs      </span></span>
<span><span class="co">#&gt;  Min.   :  98.2   Min.   :0.02165   Min.   :0.0000  </span></span>
<span><span class="co">#&gt;  1st Qu.: 442.3   1st Qu.:0.09752   1st Qu.:0.3358  </span></span>
<span><span class="co">#&gt;  Median : 635.1   Median :0.14004   Median :0.5030  </span></span>
<span><span class="co">#&gt;  Mean   : 677.0   Mean   :0.14928   Mean   :0.4834  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 860.0   3rd Qu.:0.18963   3rd Qu.:0.6461  </span></span>
<span><span class="co">#&gt;  Max.   :1601.7   Max.   :0.35317   Max.   :0.9128  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sensors</span></span>
<span><span class="co">#&gt; -------</span></span>
<span><span class="co">#&gt; No sensor energy variables available</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sl_output</span><span class="op">)</span></span></code></pre></div>
<p><img src="1-minimal_case_files/figure-html/plot_sl_output-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sl_output</span>, show_trees <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="1-minimal_case_files/figure-html/plot_sl_output_notrees-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sl_output</span>, what_trees <span class="op">=</span> <span class="st">"intercepted"</span>, what_cells <span class="op">=</span> <span class="st">"absolute"</span><span class="op">)</span></span></code></pre></div>
<p><img src="1-minimal_case_files/figure-html/plot_sl_output_aboslute-1.png" class="r-plt" alt="" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
