<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3 - More complex crown shapes • SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3 - More complex crown shapes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-minimal_case.html">1 - A first minimal case</a></li>
    <li><a class="dropdown-item" href="../articles/2-ray_tracing.html">2 - Understand ray discretization</a></li>
    <li><a class="dropdown-item" href="../articles/3-complex_crowns.html">3 - More complex crown shapes</a></li>
    <li><a class="dropdown-item" href="../articles/4-complex_inventory.html">4 - More complex inventory shapes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>3 - More complex crown shapes</h1>
            <h3 data-toc-skip class="subtitle">Represent tree crowns
with asymmetric and vertically structured shapes</h3>
            
      

      <div class="d-none name"><code>3-complex_crowns.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In previous tutorials, tree crowns were represented using simple
symmetric shapes (“E” and “P”). However, real tree crowns are often
asymmetric, both horizontally (different crown radii in different
directions) and vertically (maximum crown width not located at mid-crown
for “E” nor crown base height for “P”).</p>
<p>This tutorial explains how SamsaRaLight represents more realistic
crown geometries using composite crown shapes, and illustrates their use
on a real forest inventory.</p>
</div>
<div class="section level2">
<h2 id="crown-shapes-available-in-samsaralight">Crown shapes available in SamsaRaLight<a class="anchor" aria-label="anchor" href="#crown-shapes-available-in-samsaralight"></a>
</h2>
<p>SamsaRaLight supports the following crown types:
<code>"E", "P", "2E", "4P", "8E"</code>. The number indicates how many
crown parts are used. The letter indicates the geometric shape
(Ellipsoid or Paraboloid). Choose the simplest crown type that matches
your data quality.</p>
<div class="section level3">
<h3 id="symmetric-crown-shapes">Symmetric crown shapes<a class="anchor" aria-label="anchor" href="#symmetric-crown-shapes"></a>
</h3>
<p>Symetric shapes used in the Tutorial 1, defined by the mean crown
radius (mean of the four radius <code>rn_m</code>, <code>rs_m</code>,
<code>re_m</code> and <code>rw_m</code>) and the crown depth (computed
as <code>h_m - hbase_m</code>. These shapes are simple and efficient,
but cannot represent crown asymmetry, knowing that crown asymmetry
strongly affects light interception.</p>
<div class="section level4">
<h4 id="e-symmetric-ellipsoid">
<em>“E” — Symmetric ellipsoid</em><a class="anchor" aria-label="anchor" href="#e-symmetric-ellipsoid"></a>
</h4>
<ul>
<li><p>Single ellipsoidal volume</p></li>
<li><p>Same radius in all directions</p></li>
<li><p>Maximum radius automatically computed at mid-crown height
(<code>hmax_m = hbase_m + (h_m - hbase_m) / 2</code></p></li>
</ul>
</div>
<div class="section level4">
<h4 id="p-symmetric-paraboloid">
<em>“P” — Symmetric paraboloid</em><a class="anchor" aria-label="anchor" href="#p-symmetric-paraboloid"></a>
</h4>
<ul>
<li><p>Single paraboloid volume</p></li>
<li><p>Same radius in all directions</p></li>
<li><p>Maximum radius located at crown base height
(<code>hmax_m = base_m</code>)</p></li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="asymmetric-crown-shapes">Asymmetric crown shapes<a class="anchor" aria-label="anchor" href="#asymmetric-crown-shapes"></a>
</h3>
<p>More complex shapes are created by splitting the crown into multiple
geometric parts.</p>
<div class="section level4">
<h4 id="e-vertical-asymmetry">
<em>“2E” — Vertical asymmetry</em><a class="anchor" aria-label="anchor" href="#e-vertical-asymmetry"></a>
</h4>
<ul>
<li><p>Crown split into an upper and a lower ellipsoid</p></li>
<li><p>Allows vertical asymmetry</p></li>
<li><p>Requires <code>hmax_m</code>, the height of maximum crown
radius</p></li>
</ul>
<p>Crown remains horizontally symmetric. Use this shape when crown
expansion is not centered vertically.</p>
</div>
<div class="section level4">
<h4 id="p-horizontal-asymmetry">
<em>“4P” — Horizontal asymmetry</em><a class="anchor" aria-label="anchor" href="#p-horizontal-asymmetry"></a>
</h4>
<ul>
<li><p>Crown split into four horizontal paraboloids</p></li>
<li><p>Different radii allowed in the four cardinal directions:
<code>rn_m</code> (north), <code>rs_m</code> (south), <code>re_m</code>
(east) and <code>rw_m</code> (west)</p></li>
<li><p>Crown is vertically symmetric: <code>hmax_m</code> is NOT
required (paraboloid, thus <code>hmax = hbase_m</code>)</p></li>
</ul>
<p>Use this shape when crowns are laterally deformed by competition.</p>
</div>
<div class="section level4">
<h4 id="e-full-asymmetry">
<em>“8E” — Full asymmetry</em><a class="anchor" aria-label="anchor" href="#e-full-asymmetry"></a>
</h4>
<ul>
<li><p>Crown split into upper and lower parts (vertical
asymmetry)</p></li>
<li><p>each split into four cardinal directions (horizontal
asymmetry)</p></li>
<li><p>Requires: <code>rn_m</code>, <code>rs_m</code>,
<code>re_m</code>, <code>rw_m</code> and <code>hmax_m</code></p></li>
</ul>
<p>This is the most detailed crown representation available.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="example-asymmetric-crowns-in-a-real-stand">Example: asymmetric crowns in a real stand<a class="anchor" aria-label="anchor" href="#example-asymmetric-crowns-in-a-real-stand"></a>
</h2>
<div class="section level3">
<h3 id="context-and-data">Context and data<a class="anchor" aria-label="anchor" href="#context-and-data"></a>
</h3>
<p>We illustrate asymmetric crowns using the <strong>Bechefa</strong>
marteloscope, stored in the package as
<code><a href="../reference/data_bechefa.html">SamsaRaLight::data_bechefa</a></code>.</p>
<p>This marteloscope was installed in Belgian Ardennes by Gauthier Ligot
in the scope of the IRRES project, which investigates the transition
from even-aged to uneven-aged forest management. This is a mature mixed
stand of Douglas fir and spruce in the Belgian Ardennes. The stand has
been uneven-aged for more than 10 years.</p>
</div>
<div class="section level3">
<h3 id="tree-inventory">Tree inventory<a class="anchor" aria-label="anchor" href="#tree-inventory"></a>
</h3>
<p>All trees use the <code>"8E"</code> crown type, allowing both
horizontal and vertical asymmetry. Each tree provides four directional
crown radii (<code>rn_m</code>, <code>rs_m</code>, <code>re_m</code>,
<code>rw_m)</code> and the height of maximum crown expansion
(<code>hmax_m</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 16</span></span></span>
<span><span class="co">#&gt;   id_tree species     x     y     z dbh_cm crown_type   h_m hbase_m hmax_m  rn_m</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     103 abies   150.  13.9      0   68.4 8E          38.5    16.6   28.2  4.32</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     615 pseudo…  51.0 26.0      0   95.5 8E          50.2    14     33.3  7.01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     102 pseudo… 143.   6.97     0  112.  8E          48.2    10.8   27.1  8.38</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     708 pseudo…  27.0 28.0      0  117.  8E          51      15.8   27    7.37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     707 pseudo…  34.0 25.0      0   99.9 8E          50.5    16     26.7  6.73</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     712 pseudo…  33.0  6.99     0  112.  8E          51.4    14.4   26.5  5.02</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: rs_m &lt;dbl&gt;, re_m &lt;dbl&gt;, rw_m &lt;dbl&gt;, crown_openness &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   crown_lad &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-the-stand-and-run-the-model">Create the stand and run the model<a class="anchor" aria-label="anchor" href="#create-the-stand-and-run-the-model"></a>
</h3>
<p>The newt steps remain the same as when using symmetric crowns (see
Tutorial 1). Considering asymmetric crowns only needs to adapt the
initial tree inventory. Horizontal asymmetry is visible in the plots,
but vertical asymmetry is harder to perceive graphically because crowns
are projected.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_bechefa</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>  trees_inv <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>  aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>  north2x <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">north2x</span>,</span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">core_polygon</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stand_bechefa</span><span class="op">)</span></span></code></pre></div>
<p><img src="3-complex_crowns_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stand_bechefa</span>, top_down <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="3-complex_crowns_files/figure-html/unnamed-chunk-4-2.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">radiations_bechefa</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/get_monthly_radiations.html">get_monthly_radiations</a></span><span class="op">(</span></span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  longitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_bechefa.html">data_bechefa</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_bechefa</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/run_sl.html">run_sl</a></span><span class="op">(</span></span>
<span>  sl_stand <span class="op">=</span> <span class="va">stand_bechefa</span>,</span>
<span>  monthly_radiations <span class="op">=</span> <span class="va">radiations_bechefa</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; parallel mode disabled because OpenMP was not available</span></span>
<span><span class="co">#&gt; SamsaRaLight simulation was run successfully.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_bechefa</span><span class="op">)</span></span></code></pre></div>
<p><img src="3-complex_crowns_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" alt="" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_bechefa</span>, show_trees <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="3-complex_crowns_files/figure-html/unnamed-chunk-5-2.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
