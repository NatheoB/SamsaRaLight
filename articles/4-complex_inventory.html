<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 - More complex inventory shapes â€¢ SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4 - More complex inventory shapes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-minimal_case.html">1 - A first minimal case</a></li>
    <li><a class="dropdown-item" href="../articles/2-discretisation_directdiffuse.html">2 - Understand ray discretization with detailed output</a></li>
    <li><a class="dropdown-item" href="../articles/3-complex_crowns.html">3 - More complex crown shapes</a></li>
    <li><a class="dropdown-item" href="../articles/4-complex_inventory.html">4 - More complex inventory shapes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4 - More complex inventory shapes</h1>
            <h3 data-toc-skip class="subtitle">Non-axis-aligned GPS
inventory and non-rectangular inventory zone</h3>
            
      

      <div class="d-none name"><code>4-complex_inventory.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>collapse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>comment <span class="op">=</span> <span class="st">"#&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In previous tutorials, inventories were assumed to be simple,
axis-aligned rectangles defined directly in a local Cartesian coordinate
system (meters). In practice, however, forest inventories are often more
complex.</p>
<p>In this vignette, we illustrate two common but more advanced
situations:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Inventories based on GPS coordinates</strong>, where tree
positions are given as longitude and latitude, and the inventory
rectangle is not aligned with the virtual plot axes.</li>
<li>
<strong>Inventories with non-rectangular shapes</strong>, where the
sampled area is defined by an irregular polygon (<em>e.g.</em> a
combination of circular plots).</li>
</ol>
<p>The goal is to show how these inventories can be converted into a
consistent virtual stand suitable for SamsaRaLight simulations, while
remaining faithful to the original field protocol.</p>
</div>
<div class="section level2">
<h2 id="axis-aligned-stand-from-gps-data">Axis-aligned stand from GPS data<a class="anchor" aria-label="anchor" href="#axis-aligned-stand-from-gps-data"></a>
</h2>
<div class="section level3">
<h3 id="context-and-data">Context and data<a class="anchor" aria-label="anchor" href="#context-and-data"></a>
</h3>
<p>We first use the example inventory <strong>IRRES1</strong>, stored in
the package as <code><a href="../reference/data_IRRES1.html">SamsaRaLight::data_IRRES1</a></code>.</p>
<p>This inventory was collected in Belgian Ardennes by Gauthier Ligot in
the scope of the IRRES project, which investigates the transition from
even-aged to uneven-aged forest management. The stand is dense in a
sloppy terrain and is mainly composed of Norway spruce and Douglas-fir,
with a coppice stool of beech at its center and a few silver fir and
larch trees.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_irres</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">trees</span></span></code></pre></div>
<p>Running <code><a href="../reference/check_inventory.html">check_inventory()</a></code> on this dataset immediately
fails, with an error indicating that columns <code>x</code> and
<code>y</code> are missing. This is expected: tree positions are
provided as longitude (<code>lon</code>) and latitude
(<code>lat</code>), expressed in degrees.</p>
<p>To illustrate why this is problematic, we (incorrectly) rename
longitude and latitude to <code>x</code> and <code>y</code> and attempt
to plot the inventory.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_inventory.html">plot_inventory</a></span><span class="op">(</span></span>
<span>  <span class="va">trees_irres</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="700"></p>
<p>This plot is meaningless: angular coordinates (degrees) are
incompatible with crown dimensions expressed in meters. Before creating
a stand, coordinates must therefore be converted into a planar Cartesian
system with metric units.</p>
</div>
<div class="section level3">
<h3 id="coordinate-conversion">Coordinate conversion<a class="anchor" aria-label="anchor" href="#coordinate-conversion"></a>
</h3>
<p>Tree coordinates are converted from the global WGS84 reference system
(EPSG:4326) to a projected coordinate system expressed in meters. Here,
we use <strong>Belgian Lambert 72</strong> (EPSG:31370), which is
appropriate for the study area . For other countries, check for the
specific local projected system such as Lambert93 for France (EPSG:2154)
or UTM zone 32N for most of Europe (EPSG:23032).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees_irres_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span></span>
<span>  <span class="va">trees_irres</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">4326</span>   <span class="co"># WGS84</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">trees_irres_l72</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span></span>
<span>  <span class="va">trees_irres_sf</span>,</span>
<span>  crs <span class="op">=</span> <span class="fl">31370</span> <span class="co"># Belgian Lambert 72</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">trees_irres_l72</span><span class="op">)</span></span>
<span><span class="va">trees_irres</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">trees_irres</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>After this conversion, tree positions are expressed in meters. The
inventory can now be validated and visualized correctly.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/check_inventory.html">check_inventory</a></span><span class="op">(</span><span class="va">trees_irres</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inventory table successfully validated.</span></span>
<span><span class="fu"><a href="../reference/plot_inventory.html">plot_inventory</a></span><span class="op">(</span><span class="va">trees_irres</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="" width="700"></p>
<p>At this stage, the inventory is still not axis-aligned, and
coordinates do not start at zero. This is not an issue: the stand
creation process will handle coordinate shifts and rotations
internally.</p>
</div>
<div class="section level3">
<h3 id="defining-the-inventory-zone">Defining the inventory zone<a class="anchor" aria-label="anchor" href="#defining-the-inventory-zone"></a>
</h3>
<p>To create the virtual stand, we call <code><a href="../reference/create_sl_stand.html">create_sl_stand()</a></code>.
Because no explicit inventory polygon is provided, we set
<code>core_polygon_df = NULL</code>, which allows to infer the polygon
automatically from tree positions.</p>
<p>Because the projected coordinates follow a conventional GIS
orientation (Y axis pointing North), we set <code>north2x = 90</code>,
meaning that geographic North corresponds to the positive Y
direction.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_irres</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>  trees_inv <span class="op">=</span> <span class="va">trees_irres</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  </span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  slope    <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>  aspect  <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>  north2x <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  </span>
<span>  core_polygon_df <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stand_irres</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="" width="700"></p>
<p>The stand dimensions are chosen as the <strong>smallest grid (in
number of cells)</strong> that fully contains the inventory zone:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_irres</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">n_cells_x</span></span>
<span><span class="co">#&gt; [1] 29</span></span>
<span><span class="va">stand_irres</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">n_cells_y</span></span>
<span><span class="co">#&gt; [1] 22</span></span></code></pre></div>
<p>This corresponds to a stand size of:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_irres</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">n_cells_x</span> <span class="op">*</span> <span class="va">stand_irres</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">cell_size</span></span>
<span><span class="co">#&gt; [1] 145</span></span>
<span><span class="va">stand_irres</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">n_cells_y</span> <span class="op">*</span> <span class="va">stand_irres</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">cell_size</span></span>
<span><span class="co">#&gt; [1] 110</span></span></code></pre></div>
<p>Then, tree coordinates are shifted to a local coordinate system
starting at zero:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_irres</span><span class="op">$</span><span class="va">transform</span><span class="op">$</span><span class="va">shift_x</span></span>
<span><span class="co">#&gt; [1] -263046.4</span></span>
<span><span class="va">stand_irres</span><span class="op">$</span><span class="va">transform</span><span class="op">$</span><span class="va">shift_y</span></span>
<span><span class="co">#&gt; [1] -114242</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="axis-aligned-rectangle-option">Axis-aligned rectangle option<a class="anchor" aria-label="anchor" href="#axis-aligned-rectangle-option"></a>
</h3>
<p>As shown in the plot above, the area surrounding the rectangular
inventory zone is empty, which could affect light interception.Thus, in
most cases, it is desirable to work with a rectangle aligned with the
simulation axes. To do so, we have to rercreate the virtual stand by
setting <code>aarect_zone = TRUE</code>, which:</p>
<ol style="list-style-type: decimal">
<li>compute the minimum bounding rectangle of the inventory
polygon,</li>
<li>rotate the entire stand (trees and polygon) so that this rectangle
becomes axis-aligned,</li>
<li>update the <code>north2x</code> value accordingly.</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_irres_aarect</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>  trees_inv <span class="op">=</span> <span class="va">trees_irres</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  </span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  slope    <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>  aspect  <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>  north2x <span class="op">=</span> <span class="fl">90</span>,</span>
<span>  </span>
<span>  core_polygon_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  aarect_zone <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stand_irres_aarect</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-11-1.png" class="r-plt" alt="" width="700"></p>
<p>The rotation applied to the stand is stored internally, and the
<code>north2x</code> value is updated accordingly.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_irres_aarect</span><span class="op">$</span><span class="va">transform</span><span class="op">$</span><span class="va">rotation</span></span>
<span><span class="co">#&gt; [1] -18.75464</span></span>
<span><span class="va">stand_irres_aarect</span><span class="op">$</span><span class="va">geometry</span><span class="op">$</span><span class="va">north2x</span></span>
<span><span class="co">#&gt; [1] 108.7546</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-samsaralight">Running SamsaRaLight<a class="anchor" aria-label="anchor" href="#running-samsaralight"></a>
</h3>
<p>As shown in the previous tutorials, monthly radiation data are
retrieved using the geographic location of the stand.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_radiations_irres</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/get_monthly_radiations.html">get_monthly_radiations</a></span><span class="op">(</span></span>
<span>  latitude  <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  longitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">longitude</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And the simulation is run using <code><a href="../reference/run_sl.html">run_sl()</a></code>. By default,
the function considers virtual plot boundaries within a torus system
(<code>use_torus = TRUE</code>), treating the surrounding environment as
a copy of the virtual plot in all directions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_irres_aarect</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/run_sl.html">run_sl</a></span><span class="op">(</span></span>
<span>  sl_stand <span class="op">=</span> <span class="va">stand_irres_aarect</span>,</span>
<span>  monthly_radiations <span class="op">=</span> <span class="va">data_radiations_irres</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; parallel mode disabled because OpenMP was not available</span></span>
<span><span class="co">#&gt; SamsaRaLight simulation was run successfully.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_irres_aarect</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-14-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="non-rectangular-inventory-zones">Non-rectangular inventory zones<a class="anchor" aria-label="anchor" href="#non-rectangular-inventory-zones"></a>
</h2>
<div class="section level3">
<h3 id="context-and-data-1">Context and data<a class="anchor" aria-label="anchor" href="#context-and-data-1"></a>
</h3>
<p>We now consider the example inventory <strong>Cloture20</strong>,
stored in the package as <code><a href="../reference/data_cloture20.html">SamsaRaLight::data_cloture20</a></code>.</p>
<p>This inventory was collected by Gauthier Ligot in Wallonia, Belgium,
as part of the CLOTURE project, which investigates the effect of fences
on beech and oak plots with varying beech proportions. In this case, the
plot is primarily made up of beech trees (Fagus sylvatica). The
inventory protocol is complex and resulted in non-rectangular inventory
zones formed from multiple circular areas. Thus, the core polygon is
defined by 94 vertices:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">core_polygon</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    94 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ x: num  54 56.4 59.1 61.9 64.8 ...</span></span>
<span><span class="co">#&gt;  $ y: num  70.4 72.2 73.6 74.6 75.2 ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="virtual-stand-with-complex-core-polygon">Virtual stand with complex core polygon<a class="anchor" aria-label="anchor" href="#virtual-stand-with-complex-core-polygon"></a>
</h3>
<p>First, we can create the virtual stand by setting the pre-defined
core polygon stored in the package. Representing the inventory as a
rectangle in this case would be inconsistent with the field protocol.
Therefore, the polygon is preserved inside a larger virtual stand.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_cloture</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>  trees_inv <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  </span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  slope    <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>  aspect  <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>  north2x <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">north2x</span>,</span>
<span>  </span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">core_polygon</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stand_cloture</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-16-1.png" class="r-plt" alt="" width="700"></p>
</div>
<div class="section level3">
<h3 id="filling-around-the-inventory-zone">Filling around the inventory zone<a class="anchor" aria-label="anchor" href="#filling-around-the-inventory-zone"></a>
</h3>
<p>Outside the inventory polygon, no trees are initially present. This
may affect light interception near the edges of the inventory zone, even
when setting <code>use_torus = TRUE</code> after in the
<code><a href="../reference/run_sl.html">run_sl()</a></code> function (which affects the edges of the virtual
plot, but not the inventory zone).</p>
<p>Setting <code>fill_around = TRUE</code> when creating the vitual
stand with the <code><a href="../reference/create_sl_stand.html">create_sl_stand()</a></code> function will add
<strong>virtual trees outside the inventory polygon</strong>, within the
simulation grid. These trees are:</p>
<ul>
<li><p>randomly positioned outside the inventory zone,</p></li>
<li><p>sampled from the inventoried trees,</p></li>
<li><p>added until the surrounding area reaches the <strong>same basal
area per hectare</strong> as the inventory zone.</p></li>
</ul>
<p>This approach assumes that the surrounding stand is structurally
similar to the inventoried area.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stand_cloture_filled</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/create_sl_stand.html">create_sl_stand</a></span><span class="op">(</span></span>
<span>  trees_inv <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  </span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  slope    <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">slope</span>,</span>
<span>  aspect  <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">aspect</span>,</span>
<span>  north2x <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">north2x</span>,</span>
<span>  </span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">core_polygon</span>,</span>
<span>  fill_around <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Polygon successfully validated.</span></span>
<span><span class="co">#&gt; SamsaRaLight stand successfully created.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stand_cloture_filled</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-17-1.png" class="r-plt" alt="" width="700"></p>
<p>When plotting, the argument <code>only_inv = TRUE</code> allows
displaying only the inventoried trees (inside the yellow polygon). Added
trees are identified in the stand object using the logical column
<code>added_to_fill</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">stand_cloture_filled</span><span class="op">$</span><span class="va">trees</span><span class="op">$</span><span class="va">added_to_fill</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; FALSE  TRUE </span></span>
<span><span class="co">#&gt;   112   101</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stand-summary-and-simulation">Stand summary and simulation<a class="anchor" aria-label="anchor" href="#stand-summary-and-simulation"></a>
</h3>
<p>A summary of both the inventory zone and the full virtual stand can
be obtained with the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function, showing that both
zones exhibit similar basal area per hectare and mean quadratic
diameter.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stand_cloture_filled</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SamsaRaLight stand summary</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inventory (core polygon):</span></span>
<span><span class="co">#&gt;   Area              : 0.59 ha</span></span>
<span><span class="co">#&gt;   Trees             : 112</span></span>
<span><span class="co">#&gt;   Density           : 190.5 trees/ha</span></span>
<span><span class="co">#&gt;   Basal area        : 21.99 m2/ha</span></span>
<span><span class="co">#&gt;   Quadratic mean DBH: 38.3 cm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Simulation stand (core + filled buffer):</span></span>
<span><span class="co">#&gt;   Area              : 1.00 ha</span></span>
<span><span class="co">#&gt;   Trees             : 213</span></span>
<span><span class="co">#&gt;   Density           : 213.0 trees/ha</span></span>
<span><span class="co">#&gt;   Basal area        : 22.02 m2/ha</span></span>
<span><span class="co">#&gt;   Quadratic mean DBH: 36.3 cm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Stand geometry:</span></span>
<span><span class="co">#&gt;   Grid              : 20 x 20 (400 cells)</span></span>
<span><span class="co">#&gt;   Cell size         : 5.00 m</span></span>
<span><span class="co">#&gt;   Slope             : 0.00 deg</span></span>
<span><span class="co">#&gt;   Aspect            : 0.00 deg</span></span>
<span><span class="co">#&gt;   North to X-axis   : 90.00 deg</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of sensors: 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Available light interception models:</span></span>
<span><span class="co">#&gt;   - Turbid medium (crown_lad)</span></span>
<span><span class="co">#&gt;   - Porous envelope (crown_openness)</span></span></code></pre></div>
<p>Finally, the simulation is run as usual.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_radiations_cloture</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/get_monthly_radiations.html">get_monthly_radiations</a></span><span class="op">(</span></span>
<span>  latitude  <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">latitude</span>,</span>
<span>  longitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_cloture20.html">data_cloture20</a></span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">longitude</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_cloture_filled</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/run_sl.html">run_sl</a></span><span class="op">(</span></span>
<span>  sl_stand <span class="op">=</span> <span class="va">stand_cloture_filled</span>,</span>
<span>  monthly_radiations <span class="op">=</span> <span class="va">data_radiations_cloture</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; parallel mode disabled because OpenMP was not available</span></span>
<span><span class="co">#&gt; SamsaRaLight simulation was run successfully.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_cloture_filled</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-complex_inventory_files/figure-html/unnamed-chunk-20-1.png" class="r-plt" alt="" width="700"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
