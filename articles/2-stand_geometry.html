<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2 - Understand stand information â€¢ SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2 - Understand stand information">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-simple_case.html">1 - A first simple case</a></li>
    <li><a class="dropdown-item" href="../articles/2-stand_geometry.html">2 - Understand stand information</a></li>
    <li><a class="dropdown-item" href="../articles/3-transmission_model.html">3 - Choose the transmission model</a></li>
    <li><a class="dropdown-item" href="../articles/4-core_polygon.html">4 - Create a virtual stand from an inventory</a></li>
    <li><a class="dropdown-item" href="../articles/5-irregular_crowns.html">5 - More complex crown shapes</a></li>
    <li><a class="dropdown-item" href="../articles/7-light_sensors.html">7 - Add light sensors</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2 - Understand stand information</h1>
            <h3 data-toc-skip class="subtitle">Understand the effect of
the stand latitude, slope and aspect</h3>
            
      

      <div class="d-none name"><code>2-stand_geometry.Rmd</code></div>
    </div>

    
    
<p>This is a tutorial which shows the effect of stand geometry on light
distribution by showing the shading effect of a single large tree
depending on the latitude and the slope/aspect of the stand. This
tutorial also allows to address how the SamsaraLight model discretizes
the direct and diffuse rays.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="run-the-experiment">Run the experiment<a class="anchor" aria-label="anchor" href="#run-the-experiment"></a>
</h2>
<div class="section level3">
<h3 id="create-virtual-stands">Create virtual stands<a class="anchor" aria-label="anchor" href="#create-virtual-stands"></a>
</h3>
<p>In this tutorial, we will create from scratch a virtual stand with a
single large tree at the center.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Stand dimensions</span></span>
<span><span class="va">cell_size</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">stand_size_x</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">stand_size_y</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># Variable needed for creating the trees table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_prenovel.html">data_prenovel</a></span><span class="op">$</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id_tree"       "species"       "x"             "y"            </span></span>
<span><span class="co">#&gt;  [5] "dbh_cm"        "crown_type"    "h_m"           "hbase_m"      </span></span>
<span><span class="co">#&gt;  [9] "hmax_m"        "rn_m"          "re_m"          "rs_m"         </span></span>
<span><span class="co">#&gt; [13] "rw_m"          "crown_openess" "crown_lad"</span></span>
<span></span>
<span><span class="co"># Creating the table for this experiment (i.e. one big tree on the middle of the stand)</span></span>
<span><span class="va">data_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  id_tree <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"Fagus sylvatica"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">stand_size_x</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>  y <span class="op">=</span> <span class="va">stand_size_y</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>  dbh_cm <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  crown_type <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>  h_m <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  hbase_m <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  hmax_m <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  rn_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  re_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  rs_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  rw_m <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  crown_openess <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  crown_lad <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_tree</span></span>
<span><span class="co">#&gt;   id_tree         species  x  y dbh_cm crown_type h_m hbase_m hmax_m rn_m re_m</span></span>
<span><span class="co">#&gt; 1       1 Fagus sylvatica 50 50    100          E  40      20     NA    6    6</span></span>
<span><span class="co">#&gt;   rs_m rw_m crown_openess crown_lad</span></span>
<span><span class="co">#&gt; 1    6    6           0.2         1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-the-experimental-design">Define the experimental design<a class="anchor" aria-label="anchor" href="#define-the-experimental-design"></a>
</h3>
<p>Here, we define the experimental design, that is the
latitude/slope/aspect combinations we want to test.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Madrid"</span>, <span class="st">"Brussels"</span>, <span class="st">"Oslo"</span><span class="op">)</span>, <span class="co"># Define three towns with different latitudes in Europe</span></span>
<span>  slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  aspect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">180</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span>  <span class="co"># Set the longitude/latitude of our three towns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    latitude <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">city</span>,</span>
<span>                          <span class="st">"Madrid"</span> <span class="op">~</span> <span class="fl">40.4167</span>,</span>
<span>                          <span class="st">"Brussels"</span> <span class="op">~</span> <span class="fl">50.8477</span>,</span>
<span>                          <span class="st">"Oslo"</span> <span class="op">~</span> <span class="fl">59.9122</span><span class="op">)</span>,</span>
<span>    longitude <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">city</span>,</span>
<span>                          <span class="st">"Madrid"</span> <span class="op">~</span> <span class="op">-</span><span class="fl">3.7033</span>,</span>
<span>                          <span class="st">"Brussels"</span> <span class="op">~</span> <span class="fl">4.3572</span>,</span>
<span>                          <span class="st">"Oslo"</span> <span class="op">~</span> <span class="fl">10.7313</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">slope</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">aspect</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Because aspect do not change anything in a flat plane</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stand_geom <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>                  <span class="va">slope</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"flat"</span>,</span>
<span>                  <span class="va">slope</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">aspect</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="st">"slope north"</span>,</span>
<span>                  <span class="va">slope</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">aspect</span> <span class="op">==</span> <span class="fl">180</span> <span class="op">~</span> <span class="st">"slope south"</span><span class="op">)</span>,</span>
<span>                mod_id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">mod_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">exp_design</span></span>
<span><span class="co">#&gt;   mod_id     city slope aspect latitude longitude  stand_geom</span></span>
<span><span class="co">#&gt; 1      1   Madrid     0      0  40.4167   -3.7033        flat</span></span>
<span><span class="co">#&gt; 2      2 Brussels     0      0  50.8477    4.3572        flat</span></span>
<span><span class="co">#&gt; 3      3     Oslo     0      0  59.9122   10.7313        flat</span></span>
<span><span class="co">#&gt; 4      4   Madrid    20      0  40.4167   -3.7033 slope north</span></span>
<span><span class="co">#&gt; 5      5 Brussels    20      0  50.8477    4.3572 slope north</span></span>
<span><span class="co">#&gt; 6      6     Oslo    20      0  59.9122   10.7313 slope north</span></span>
<span><span class="co">#&gt; 7      7   Madrid    20    180  40.4167   -3.7033 slope south</span></span>
<span><span class="co">#&gt; 8      8 Brussels    20    180  50.8477    4.3572 slope south</span></span>
<span><span class="co">#&gt; 9      9     Oslo    20    180  59.9122   10.7313 slope south</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-samsaralight-for-each-virtual-stand">Run SamsaraLight for each virtual stand<a class="anchor" aria-label="anchor" href="#run-samsaralight-for-each-virtual-stand"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store SamsaraLight outputs in a list</span></span>
<span><span class="va">out_sl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mod_design</span> <span class="op">&lt;-</span> <span class="va">exp_design</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Get the radiation from PVGIS database</span></span>
<span>  <span class="va">tmp_rad</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/get_monthly_rad.html">get_monthly_rad</a></span><span class="op">(</span><span class="va">mod_design</span><span class="op">$</span><span class="va">latitude</span>, <span class="va">mod_design</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Run SamsaraLight</span></span>
<span>  <span class="va">out_sl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/sl_run.html">sl_run</a></span><span class="op">(</span></span>
<span>    trees <span class="op">=</span> <span class="va">data_tree</span>,</span>
<span>    monthly_rad <span class="op">=</span> <span class="va">tmp_rad</span>,</span>
<span>    cell_size <span class="op">=</span> <span class="va">cell_size</span>,</span>
<span>    n_cells_x <span class="op">=</span> <span class="va">stand_size_x</span> <span class="op">/</span> <span class="va">cell_size</span>, </span>
<span>    n_cells_y <span class="op">=</span> <span class="va">stand_size_y</span> <span class="op">/</span> <span class="va">cell_size</span>, </span>
<span>    latitude <span class="op">=</span> <span class="va">mod_design</span><span class="op">$</span><span class="va">latitude</span>, </span>
<span>    slope <span class="op">=</span> <span class="va">mod_design</span><span class="op">$</span><span class="va">slope</span>, </span>
<span>    aspect <span class="op">=</span> <span class="va">mod_design</span><span class="op">$</span><span class="va">aspect</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="observe-the-outputs">Observe the outputs<a class="anchor" aria-label="anchor" href="#observe-the-outputs"></a>
</h2>
<div class="section level3">
<h3 id="understand-the-discretisation-of-direct-and-diffuse-rays">Understand the discretisation of direct and diffuse rays<a class="anchor" aria-label="anchor" href="#understand-the-discretisation-of-direct-and-diffuse-rays"></a>
</h3>
<p>The discretisation of the rays are given in the
<code>$monthly_rays$rays</code> of the <code><a href="../reference/sl_run.html">sl_run()</a></code> function
output, with the total energy (in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>J</mi><msup><mi>.</mi><mrow><mi>m</mi><mo>âˆ’</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">MJ.^{m-2}</annotation></semantics></math>)
given in <code>$monthly_rays$energies</code> for both direct and diffuse
radiations, either on a horizontal flat plane or in the slope. The basic
output variables use the direct and diffuse energies on the slope, but
the horizontal energies are needed in the case of using virtual sensors
(see Tutorial 7 - Estimate light on virtual sensors).</p>
<p>The direct rays (direct = TRUE) are created following the trajectory
of the sun across the year, that depends on the stand latitude and the
diffuse rays (direct = FALSE) are discretized by creating rays that are
coming from all the directions across the sky. The direction of a ray is
defined by its azimut, and the orientation by the height_angle column,
both in radians. The incident energies of direct and diffuse rays (in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>J</mi><msup><mi>.</mi><mrow><mi>m</mi><mo>âˆ’</mo><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">MJ.^{m-2}</annotation></semantics></math>)
are estimated from the monthly global energy and diffuse to global
ratio, created above from the function
<code><a href="../reference/get_monthly_rad.html">SamsaRaLight::get_monthly_rad()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sl</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">monthly_rays</span><span class="op">$</span><span class="va">energies</span></span>
<span><span class="co">#&gt;       slope_direct      slope_diffuse  horizontal_direct horizontal_diffuse </span></span>
<span><span class="co">#&gt;           3052.300           1893.455           4289.146           1941.553</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">out_sl</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">monthly_rays</span><span class="op">$</span><span class="va">rays</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id_ray   azimut height_angle e_incident direct</span></span>
<span><span class="co">#&gt; 1      1 5.478378    0.4405345   17.30552   TRUE</span></span>
<span><span class="co">#&gt; 2      2 5.396980    0.4846145   17.30567   TRUE</span></span>
<span><span class="co">#&gt; 3      3 5.310983    0.5243855   17.30579   TRUE</span></span>
<span><span class="co">#&gt; 4      4 5.220347    0.5593080   17.30588   TRUE</span></span>
<span><span class="co">#&gt; 5      5 5.125242    0.5888384   17.30594   TRUE</span></span>
<span><span class="co">#&gt; 6      6 5.026082    0.6124568   17.30599   TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="change-in-incident-energy-with-stand-latitude-and-geometry">Change in incident energy with stand latitude and geometry<a class="anchor" aria-label="anchor" href="#change-in-incident-energy-with-stand-latitude-and-geometry"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dataframe for comparing incident energies</span></span>
<span><span class="va">out_sl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">monthly_rays</span><span class="op">$</span><span class="va">energies</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"mod_id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mod_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">mod_id</span><span class="op">)</span>,</span>
<span>                horizontal_total <span class="op">=</span> <span class="va">horizontal_direct</span> <span class="op">+</span> <span class="va">horizontal_diffuse</span>,</span>
<span>                slope_total <span class="op">=</span> <span class="va">slope_direct</span> <span class="op">+</span> <span class="va">slope_diffuse</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">mod_id</span>, </span>
<span>                      names_pattern <span class="op">=</span> <span class="st">"(.*)_(.*)"</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"surface"</span>, <span class="st">"type"</span><span class="op">)</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"energy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">exp_design</span>, by <span class="op">=</span> <span class="st">"mod_id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">surface</span> <span class="op">==</span> <span class="st">"slope"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  </span>
<span><span class="co"># Plot the graphic</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">energy</span>, x <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">stand_geom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Incident energy in MJ/m2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Type of the rays"</span><span class="op">)</span></span></code></pre></div>
<p><img src="2-stand_geometry_files/figure-html/graph_energies-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="plot-the-samsaralight-outputs">Plot the SamsaraLight outputs<a class="anchor" aria-label="anchor" href="#plot-the-samsaralight-outputs"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store plots in a list</span></span>
<span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">legend</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exp_design</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mod_design</span> <span class="op">&lt;-</span> <span class="va">exp_design</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Plot the stand with light outputs</span></span>
<span>  <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_sl_output.html">plot_sl_output</a></span><span class="op">(</span><span class="va">out_sl</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                              trees.fill <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>                                              cells.fill <span class="op">=</span> <span class="st">"pacl"</span>,</span>
<span>                                              cells.fill.palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Change some ggplot2 features</span></span>
<span>  <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">mod_design</span><span class="op">$</span><span class="va">city</span>, </span>
<span>                          <span class="st">"|"</span>, <span class="va">mod_design</span><span class="op">$</span><span class="va">stand_geom</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>          axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_color_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    </span>
<span>  <span class="co"># Fetch the legend if it is not already done</span></span>
<span>  <span class="co"># And remove the plot legend after that</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">legend</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">legend</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html" class="external-link">get_legend</a></span><span class="op">(</span><span class="va">tmp_sl_plot</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">tmp_sl_plot</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>    </span>
<span>  </span>
<span>  <span class="co"># Add the plot to the list</span></span>
<span>  <span class="va">plot_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tmp_sl_plot</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Gather all the plots using the cowplot package</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">legend</span>,</span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span>plotlist <span class="op">=</span> <span class="va">plot_list</span>,</span>
<span>                     nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="2-stand_geometry_files/figure-html/plot_pacl-1.png" width="768"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
