<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 - Create a virtual stand from an inventory • SamsaRaLight</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4 - Create a virtual stand from an inventory">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SamsaRaLight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1-simple_case.html">1 - A first simple case</a></li>
    <li><a class="dropdown-item" href="../articles/2-stand_geometry.html">2 - Understand stand information</a></li>
    <li><a class="dropdown-item" href="../articles/3-transmission_model.html">3 - Choose the transmission model</a></li>
    <li><a class="dropdown-item" href="../articles/4-core_polygon.html">4 - Create a virtual stand from an inventory</a></li>
    <li><a class="dropdown-item" href="../articles/5-irregular_crowns.html">5 - More complex crown shapes</a></li>
    <li><a class="dropdown-item" href="../articles/7-light_sensors.html">7 - Add light sensors</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>4 - Create a virtual stand from an inventory</h1>
            <h3 data-toc-skip class="subtitle">Create an axis-aligned
rectangle virtual stand from an inventory of trees</h3>
            
      

      <div class="d-none name"><code>4-core_polygon.Rmd</code></div>
    </div>

    
    
<p>This is a tutorial to explain how to create a well formatted
SamsaraLight virtual stand from an inventory of trees. At the end of
this tutorial, we will better understand how the SamsaraLight model
manages the light interception of the trees at the edges of the
inventory and the surrounding environment with trees that are not
inventoried using a torus system.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://natheob.github.io/SamsaRaLight/">SamsaRaLight</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com" class="external-link">ggforce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for randomization reproducibility</span></span>
<span><span class="co"># Needed when filling outside the core polygone (see below)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5030</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="inventory-info-and-constraints">Inventory info and constraints<a class="anchor" aria-label="anchor" href="#inventory-info-and-constraints"></a>
</h2>
<p>In this tutorial, we will use an inventory collected in the scope of
the IRRES project, that aims to understand the mechanisms of the
transition from even-aged to uneven-aged management. Here, the IRRES1
stand is composed of common spruce and Douglas fir, with a coppice stool
of beech at its center and few silver fir and larch trees.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id_tree              species        x        y dbh_cm crown_type   h_m</span></span>
<span><span class="co">#&gt; 1       1 Pseudtsuga menziesii 263190.6 114308.9   36.5          P 28.22</span></span>
<span><span class="co">#&gt; 2       3 Pseudtsuga menziesii 263181.9 114298.9   37.3          P 31.18</span></span>
<span><span class="co">#&gt; 3       4          Picea abies 263185.0 114302.7   18.7          P 19.48</span></span>
<span><span class="co">#&gt; 4       5          Picea abies 263183.3 114312.4   27.0          P 23.39</span></span>
<span><span class="co">#&gt; 5       6 Pseudtsuga menziesii 263180.1 114307.6   31.0          P 30.87</span></span>
<span><span class="co">#&gt; 6       7          Picea abies 263181.4 114304.5   22.0          P 21.04</span></span>
<span><span class="co">#&gt;   hbase_m hmax_m rn_m rs_m re_m rw_m crown_openess crown_lad</span></span>
<span><span class="co">#&gt; 1   10.42     NA 3.80 3.80 3.80 3.80           0.6       0.5</span></span>
<span><span class="co">#&gt; 2   14.44     NA 3.94 3.94 3.94 3.94           0.6       0.5</span></span>
<span><span class="co">#&gt; 3    9.99     NA 2.09 2.09 2.09 2.09           0.6       0.5</span></span>
<span><span class="co">#&gt; 4   11.38     NA 2.39 2.39 2.39 2.39           0.6       0.5</span></span>
<span><span class="co">#&gt; 5   13.04     NA 3.97 3.97 3.97 3.97           0.6       0.5</span></span>
<span><span class="co">#&gt; 6   10.54     NA 2.21 2.21 2.21 2.21           0.6       0.5</span></span></code></pre></div>
<p>The format and protocol of the inventory here lead us to two new
constraints:</p>
<ol style="list-style-type: decimal">
<li>The inventory zone appeared to be a rectangle, but is not
axis-aligned : we need to an axis-aligned rectangle stand where we
include the inventory zone inside.</li>
<li>The coordinates are in a particular coordinate system: we need to
convert them into ones relative to the created virtual rectangle
stand.</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">trees</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Radius here are the same across the four cardinals (symmetric crowns)</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_circle.html" class="external-link">geom_circle</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x</span>, </span>
<span>                            y0 <span class="op">=</span> <span class="va">y</span>, </span>
<span>                            r <span class="op">=</span> <span class="va">rn_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="define-the-inventory-zone">Define the inventory zone<a class="anchor" aria-label="anchor" href="#define-the-inventory-zone"></a>
</h2>
<p>We first need to define the inventory zone by creating a data.frame
of vertices. In this tutorial, the IRRES1 as it is a rectangle inventory
zone, thus defined by 4 vertices. The core polygon data.frame is stored
within the <code><a href="../reference/data_IRRES1.html">SamsaRaLight::data_IRRES1</a></code> package resource:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">core_polygon</span></span>
<span><span class="co">#&gt;          x        y</span></span>
<span><span class="co">#&gt; 1 263193.1 114310.3</span></span>
<span><span class="co">#&gt; 2 263168.5 114237.4</span></span>
<span><span class="co">#&gt; 3 263045.3 114279.0</span></span>
<span><span class="co">#&gt; 4 263070.0 114351.9</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">trees</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Radius here are the same across the four cardinals (symmetric crowns)</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_circle.html" class="external-link">geom_circle</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x</span>, </span>
<span>                            y0 <span class="op">=</span> <span class="va">y</span>, </span>
<span>                            r <span class="op">=</span> <span class="va">rn_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="co"># Plot the inventory zone</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">core_polygon</span>, </span>
<span>               mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, </span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               fill <span class="op">=</span> <span class="st">"yellow"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="create-the-virtual-stand">Create the virtual stand<a class="anchor" aria-label="anchor" href="#create-the-virtual-stand"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cell_size</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></code></pre></div>
<p>After defining the inventory zone with a polygon, we need to include
it in an axis-aligned rectangle plot with the coordinates formatted
between 0 and the minimum witdth/height including the inventory zone. To
do so, the user can use the function <code><a href="../reference/create_rect_stand.html">create_rect_stand()</a></code> to
create the virtual stand and modify the trees and the core polygon
coordinates, given a cell size.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_stand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_rect_stand.html">create_rect_stand</a></span><span class="op">(</span></span>
<span>  trees <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="va">cell_size</span>, </span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">core_polygon</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output of this function returns a list of different elements :
<code>$trees</code> which is the updated tree data.frame with shifted
coordinates, <code>$inv_zone_df</code> which is the updated core polygon
data.frame with the shifted coordinates, <code>$inv_zone_sf</code> which
is the <code>sf</code> object corresponding to the core polygon and
<code>$info</code> is a list with information about the virtual stand
creation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sl_stand</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ trees      :'data.frame': 522 obs. of  16 variables:</span></span>
<span><span class="co">#&gt;   ..$ id_tree      : int [1:522] 1 3 4 5 6 7 8 9 10 12 ...</span></span>
<span><span class="co">#&gt;   ..$ species      : chr [1:522] "Pseudtsuga menziesii" "Pseudtsuga menziesii" "Picea abies" "Picea abies" ...</span></span>
<span><span class="co">#&gt;   ..$ x            : num [1:522] 146 138 141 139 136 ...</span></span>
<span><span class="co">#&gt;   ..$ y            : num [1:522] 71.8 61.8 65.6 75.2 70.5 ...</span></span>
<span><span class="co">#&gt;   ..$ dbh_cm       : num [1:522] 36.5 37.3 18.7 27 31 22 17.7 33.9 33.5 21.7 ...</span></span>
<span><span class="co">#&gt;   ..$ crown_type   : chr [1:522] "P" "P" "P" "P" ...</span></span>
<span><span class="co">#&gt;   ..$ h_m          : num [1:522] 28.2 31.2 19.5 23.4 30.9 ...</span></span>
<span><span class="co">#&gt;   ..$ hbase_m      : num [1:522] 10.42 14.44 9.99 11.38 13.04 ...</span></span>
<span><span class="co">#&gt;   ..$ hmax_m       : logi [1:522] NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ rn_m         : num [1:522] 3.8 3.94 2.09 2.39 3.97 2.21 2.18 4.78 2.62 2.16 ...</span></span>
<span><span class="co">#&gt;   ..$ rs_m         : num [1:522] 3.8 3.94 2.09 2.39 3.97 2.21 2.18 4.78 2.62 2.16 ...</span></span>
<span><span class="co">#&gt;   ..$ re_m         : num [1:522] 3.8 3.94 2.09 2.39 3.97 2.21 2.18 4.78 2.62 2.16 ...</span></span>
<span><span class="co">#&gt;   ..$ rw_m         : num [1:522] 3.8 3.94 2.09 2.39 3.97 2.21 2.18 4.78 2.62 2.16 ...</span></span>
<span><span class="co">#&gt;   ..$ crown_openess: num [1:522] 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 0.6 ...</span></span>
<span><span class="co">#&gt;   ..$ crown_lad    : num [1:522] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</span></span>
<span><span class="co">#&gt;   ..$ added_to_fill: logi [1:522] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ inv_zone_df:'data.frame': 5 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ x: num [1:5] 148.9 124.3 1.1 25.8 148.9</span></span>
<span><span class="co">#&gt;   ..$ y: num [1:5] 73.15 0.25 41.85 114.75 73.15</span></span>
<span><span class="co">#&gt;  $ inv_zone_sf:Classes 'sf' and 'data.frame':    1 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ id      : int 1</span></span>
<span><span class="co">#&gt;   ..$ geometry:sfc_POLYGON of length 1; first list element: List of 1</span></span>
<span><span class="co">#&gt;   .. ..$ : num [1:5, 1:2] 148.9 124.3 1.1 25.8 148.9 ...</span></span>
<span><span class="co">#&gt;   .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "sf_column")= chr "geometry"</span></span>
<span><span class="co">#&gt;  $ info       :List of 10</span></span>
<span><span class="co">#&gt;   ..$ core_area_ha   : num 1</span></span>
<span><span class="co">#&gt;   ..$ core_batot_m2ha: num 29.9</span></span>
<span><span class="co">#&gt;   ..$ n_added_tree   : num 0</span></span>
<span><span class="co">#&gt;   ..$ new_area_ha    : num 1.73</span></span>
<span><span class="co">#&gt;   ..$ new_batot_m2ha : num 17.3</span></span>
<span><span class="co">#&gt;   ..$ cell_size      : num 5</span></span>
<span><span class="co">#&gt;   ..$ n_cells_x      : num 30</span></span>
<span><span class="co">#&gt;   ..$ n_cells_y      : num 23</span></span>
<span><span class="co">#&gt;   ..$ shift_x        : num -263044</span></span>
<span><span class="co">#&gt;   ..$ shift_y        : num -114237</span></span></code></pre></div>
<p>We can observe the defined inventory zone with the new shifted
coordinates:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sl_stand</span><span class="op">$</span><span class="va">trees</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Radius here are the same across the four cardinals (symmetric crowns)</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_circle.html" class="external-link">geom_circle</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x</span>, </span>
<span>                            y0 <span class="op">=</span> <span class="va">y</span>, </span>
<span>                            r <span class="op">=</span> <span class="va">rn_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">inv_zone_sf</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"yellow"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Adding new coordinate system, which will replace the existing one.</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Given in the <code>$info</code> output, we see that the inventory
zone was about 1.0003075 hectare (“core_area_ha”) with a total basal
area of
29.9018908<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mn>2</mn></msup><mi>.</mi><mi>h</mi><msup><mi>a</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">m^2.ha^{-1}</annotation></semantics></math>
(“core_batot_m2ha”). The new created virtual stand is now about 1.725
hectare (“new_area_ha”) with a total basal area of
17.3397598<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mn>2</mn></msup><mi>.</mi><mi>h</mi><msup><mi>a</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">m^2.ha^{-1}</annotation></semantics></math>
(“new_batot_m2ha”), which is necessary lower because we have the same
trees in a larger area. The virtual stand is composed of 30 cells in the
X-axis (“n_cells_x”) and 23 cells in the Y-axis (“n_cells_y”), with the
cell size that was chosen before by the user. Finally, the coordinates
has been shifted by -2.630442^{5} meters along the X-axis (“shift_x”)
and by -1.1423715^{5} meters along the Y-axis (“shift_y”).</p>
<p>We can use the information from the output of the
<code><a href="../reference/create_rect_stand.html">create_rect_stand()</a></code> to run the SamsaraLight model on the
IRRES1 inventory :</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sl</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/sl_run.html">sl_run</a></span><span class="op">(</span></span>
<span>  <span class="co"># Trees</span></span>
<span>  trees <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">trees</span>, </span>
<span>  </span>
<span>  <span class="co"># Radiations</span></span>
<span>  monthly_rad <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">radiations</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  </span>
<span>  <span class="co"># Stand geometry</span></span>
<span>  slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"slope"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"aspect"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  north_to_x_cw <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"north_to_x_cw"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="va">cell_size</span>, </span>
<span>  </span>
<span>  <span class="co"># Here, the size of the new axis-aligned rectangle stand are stored in the </span></span>
<span>  <span class="co"># output of the create_rect_stand() function</span></span>
<span>  n_cells_x <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_x</span>, </span>
<span>  n_cells_y <span class="op">=</span> <span class="va">sl_stand</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_y</span>,</span>
<span>  </span>
<span>  <span class="co"># Transmission model (default is the turbid medium)</span></span>
<span>  turbid_medium <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can observe the output light distribution on the ground based on
the new created virtual stand :</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sl_output.html">plot_sl_output</a></span><span class="op">(</span><span class="va">out_sl</span>, </span>
<span>               cells.fill <span class="op">=</span> <span class="st">"pacl"</span>, </span>
<span>               cells.fill.palette <span class="op">=</span> <span class="st">"light01"</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/plot_nofill-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="fill-the-virtual-stand-around-the-inventory-zone">Fill the virtual stand around the inventory zone<a class="anchor" aria-label="anchor" href="#fill-the-virtual-stand-around-the-inventory-zone"></a>
</h2>
<p>As we can see above, the inventory zone is including on the center of
an empty stand. However, running the SamsaraLigth model on this virtual
stand will bias the light estimation, as the trees on the edge of the
stand may intercept more energies than it should on the field, where
there are in fact surrounded by other trees that we were not
inventoried. Consequently, light on the ground around the inventory zone
appeared to be higher than it would be on the field.</p>
<p>To counteract this constraint, we can mimic a consistent surrounding
environment by filling the virtual stand around the inventory zone with
trees that composed the inventory, until we reach the total basal area
per hectare of the inventory zone. By doing so, the virtual stand can be
considered as representative of the inventory zone.</p>
<p>To do so, we can set the argument fill_around to TRUE on the
<code><a href="../reference/create_rect_stand.html">create_rect_stand()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sl_stand_filled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_rect_stand.html">create_rect_stand</a></span><span class="op">(</span></span>
<span>  trees <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">trees</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="va">cell_size</span>, </span>
<span>  core_polygon_df <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">core_polygon</span>,</span>
<span>  fill_around <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can observe the new created filled axis-aligned rectangle plot
:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">trees</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Radius here are the same across the four cardinals (symmetric crowns)</span></span>
<span>  <span class="fu"><a href="https://ggforce.data-imaginist.com/reference/geom_circle.html" class="external-link">geom_circle</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">x</span>, </span>
<span>                            y0 <span class="op">=</span> <span class="va">y</span>, </span>
<span>                            r <span class="op">=</span> <span class="va">rn_m</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">inv_zone_sf</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"yellow"</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Adding new coordinate system, which will replace the existing one.</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>We can use the new information from the output of the
<code><a href="../reference/create_rect_stand.html">create_rect_stand()</a></code> to run the SamsaraLight model on the
IRRES1 inventory by considering the surrounding environment.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sl_filled</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/sl_run.html">sl_run</a></span><span class="op">(</span></span>
<span>  <span class="co"># Trees</span></span>
<span>  trees <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">trees</span>, </span>
<span>  </span>
<span>  <span class="co"># Radiations</span></span>
<span>  monthly_rad <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">radiations</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  </span>
<span>  <span class="co"># Stand geometry</span></span>
<span>  slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"slope"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"aspect"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  north_to_x_cw <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"north_to_x_cw"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="va">cell_size</span>, </span>
<span>  </span>
<span>  <span class="co"># Here, the size of the new axis-aligned rectangle stand are stored in the </span></span>
<span>  <span class="co"># output of the create_rect_stand() function</span></span>
<span>  n_cells_x <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_x</span>, </span>
<span>  n_cells_y <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_y</span>,</span>
<span>  </span>
<span>  <span class="co"># Transmission model (default is the turbid medium)</span></span>
<span>  turbid_medium <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>And we can observe the final output light distribution on the ground
based on the new created virtual stand. We can fill the trees with a new
variables created in the trees dataset from the
<code><a href="../reference/create_rect_stand.html">create_rect_stand()</a></code> (added_to_fill) that is TRUE is the
tree was not in the initial inventory and has been added to fill around
the core polygon:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sl_output.html">plot_sl_output</a></span><span class="op">(</span><span class="va">out_sl_filled</span>, </span>
<span>               cells.fill <span class="op">=</span> <span class="st">"pacl"</span>, </span>
<span>               cells.fill.palette <span class="op">=</span> <span class="st">"light01"</span>,</span>
<span>               trees.fill <span class="op">=</span> <span class="st">"added_to_fill"</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/plot_fill-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="understanding-the-torus-system">Understanding the torus system<a class="anchor" aria-label="anchor" href="#understanding-the-torus-system"></a>
</h2>
<p>This constraint on the edges of the inventory zone could also be
extended to the edges of the rectangle virtual plot. Indeed, how the
model represents the surrounding environment of the virtual stand ?</p>
<p>To do so, the model represents the stand as a torus system (see
Courbaud et al. 2003), that looks like a “donuts” form, by virtually
gathering the left and the rights edges of the rectangle, and the top
and bottom edges together. Specifically, it considers that the trees on
the top edges are surrounding by the trees at the bottom edges (and
inversely), and that the trees on the left edges are surrounded by the
trees on the right edges (and inversely). By doing so, we can consider
that trees at any point in the virtual stand are surrounded by trees
representative of the stand.</p>
<p>In the SamsaRaLight R package, the torus system is by default applied
with the default argument <code>use_torus = TRUE</code> of the
<code><a href="../reference/sl_run.html">sl_run()</a></code> function. We can compare the light on the ground
of the IRRES1 inventory with or without applying a torus system. As we
can expect, the relative light on the ground is greater on the edges of
the virtual stands when the torus system is NOT applied.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_sl_filled_noTorus</span> <span class="op">&lt;-</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="fu"><a href="../reference/sl_run.html">sl_run</a></span><span class="op">(</span></span>
<span>  <span class="co"># Trees</span></span>
<span>  trees <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">trees</span>, </span>
<span>  </span>
<span>  <span class="co"># Radiations</span></span>
<span>  monthly_rad <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">radiations</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"latitude"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  </span>
<span>  <span class="co"># Stand geometry</span></span>
<span>  slope <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"slope"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  aspect <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"aspect"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  north_to_x_cw <span class="op">=</span> <span class="fu">SamsaRaLight</span><span class="fu">::</span><span class="va"><a href="../reference/data_IRRES1.html">data_IRRES1</a></span><span class="op">$</span><span class="va">info</span><span class="op">[[</span><span class="st">"north_to_x_cw"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  cell_size <span class="op">=</span> <span class="va">cell_size</span>, </span>
<span>  </span>
<span>  <span class="co"># Here, the size of the new axis-aligned rectangle stand are stored in the </span></span>
<span>  <span class="co"># output of the create_rect_stand() function</span></span>
<span>  n_cells_x <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_x</span>, </span>
<span>  n_cells_y <span class="op">=</span> <span class="va">sl_stand_filled</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_cells_y</span>,</span>
<span>  </span>
<span>  <span class="co"># Transmission model (default is the turbid medium)</span></span>
<span>  turbid_medium <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  </span>
<span>  <span class="co"># Use a torus system for representing plot edges (default to TRUE)</span></span>
<span>  use_torus <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="with-a-torus-system">With a torus system<a class="anchor" aria-label="anchor" href="#with-a-torus-system"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sl_output.html">plot_sl_output</a></span><span class="op">(</span><span class="va">out_sl_filled</span>, </span>
<span>               cells.fill <span class="op">=</span> <span class="st">"pacl"</span>, </span>
<span>               cells.fill.palette <span class="op">=</span> <span class="st">"light01"</span>,</span>
<span>               trees.fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/plot_fill_torus-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="without-the-torus-system">Without the torus system<a class="anchor" aria-label="anchor" href="#without-the-torus-system"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_sl_output.html">plot_sl_output</a></span><span class="op">(</span><span class="va">out_sl_filled_noTorus</span>, </span>
<span>               cells.fill <span class="op">=</span> <span class="st">"pacl"</span>, </span>
<span>               cells.fill.palette <span class="op">=</span> <span class="st">"light01"</span>,</span>
<span>               trees.fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p><img src="4-core_polygon_files/figure-html/plot_fill_notorus-1.png" width="768"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Natheo Beauchamp, Gauthier Ligot, Francois de Coligny, Maxime Jaunatre, Benoit Courbaud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
